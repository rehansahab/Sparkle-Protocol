<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sparkle Protocol - Practical Implementation Guide</title>
    <link rel="stylesheet" href="css/academic-ultra-clean.css">
    <link rel="stylesheet" href="css/navigation-professional.css">
    <link rel="stylesheet" href="css/mobile-fixes.css">
    <link rel="stylesheet" href="css/rfc-professional.css">
    <link rel="stylesheet" href="css/responsive-enhancements.css">
</head>
<body>
    <nav class="academic-nav">
        <div class="container">
            <div class="logo"><img src="images/sparkle-logo.png" alt="" class="logo-icon">Sparkle Protocol</div>
            <div class="nav-wrapper">
                <div class="nav-row">
                    <ul class="internal-nav">
                        <li><a href="index.html#abstract">Abstract</a></li>
                        <li><a href="index.html#specification">Specification</a></li>
                        <li><a href="index.html#economics">Economics</a></li>
                        <li><a href="index.html#marketplace">Marketplace</a></li>
                        <li><a href="index.html#implementation">Implementation</a></li>
                    </ul>
                </div>
                <div class="nav-row">
                    <ul class="external-nav">
                        <li><a href="whitepaper.html">Whitepaper</a></li>
                        <li><a href="practical-implementation.html">Guide</a></li>
                        <li><a href="formal-proofs.html">Proofs</a></li>
                        <li><a href="developer-sdk.html">SDK</a></li>
                        <li><a href="protocol-comparison.html">Compare</a></li>
                        <li><a href="vision.html">Vision</a></li>
                        <li><a href="technical-reality.html">Analysis</a></li>
                        <li><a href="glossary.html">Glossary</a></li>
                    </ul>
                </div>
            </div>
            <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">☰</button>
        </div>
    </nav>

    <a href="index.html" class="back-button">← Back to Home</a>

    <main class="container">
        <article class="paper">
                <h1>Sparkle Protocol: Practical Implementation Guide</h1>
            <p><em>You are in the Implementation Track – testnet experiments and developer guides.</em></p>

            <section class="section" aria-label="Status and Risks">
                <div class="warning-box">
                    <p><strong>Status: Testnet Experiments Only</strong></p>
                    <ul>
                        <li><strong>Testnet only:</strong> Never use on mainnet</li>
                        <li><strong>No production infrastructure:</strong> Coordinators, indexers don't exist</li>
                        <li><strong>Breaking changes expected:</strong> APIs will change</li>
                        <li><strong>Educational purpose:</strong> For learning and experimentation</li>
                    </ul>
                </div>
            </section>

    <div class="version-info">
        <p><strong>Implementation Guide - Testnet Only</strong></p>
        <p>Version 0.1.0 | January 2025</p>
        <p>For Developers & Testers</p>
    </div>

    <div class="abstract">
        <h2>Overview</h2>
        <p>
            This guide provides step-by-step instructions for testing Sparkle Protocol on Bitcoin testnet. It covers setting up a Lightning node, creating Sparkle-compatible inscriptions, and understanding the proposed trading flow.
        </p>
        <div class="warning">
            <strong>Warning:</strong> This guide is for testnet experimentation only. Do not use these instructions on mainnet. No production coordinator exists, and the protocol has not been audited.
        </div>
    </div>

    <h2 id="prerequisites">1. Prerequisites</h2>

    <h3>1.1 Required Software</h3>
    <p>Before implementing Sparkle Protocol, you'll need:</p>
    <ul>
        <li><strong>Bitcoin Core:</strong> Testnet full node (v25.0+)</li>
        <li><strong>Lightning Network Node:</strong> LND (v0.17+) or Core Lightning (v23.11+)</li>
        <li><strong>Ord:</strong> Ordinals inscription tool (v0.14.0+)</li>
        <li><strong>Node.js:</strong> v18+ (for coordinator/SDK development)</li>
        <li><strong>Testnet Bitcoin:</strong> From a faucet</li>
    </ul>

    <h3>1.2 Estimated Setup Time</h3>
    <ul>
        <li>Bitcoin Core sync (testnet): 2-4 hours</li>
        <li>Lightning node setup: 1-2 hours</li>
        <li>Ord installation: 15 minutes</li>
        <li>First inscription: 30 minutes</li>
    </ul>

    <div class="note">
        <strong>Note:</strong> This guide assumes basic familiarity with Bitcoin, Lightning Network, and command line tools.
    </div>

    <h2 id="bitcoin-setup">2. Bitcoin Core Setup (Testnet)</h2>

    <h3>2.1 Install Bitcoin Core</h3>
    <pre># Download from bitcoin.org
wget https://bitcoincore.org/bin/bitcoin-core-25.0/bitcoin-25.0-x86_64-linux-gnu.tar.gz

# Extract and install
tar -xzf bitcoin-25.0-x86_64-linux-gnu.tar.gz
sudo install -m 0755 -o root -g root -t /usr/local/bin bitcoin-25.0/bin/*</pre>

    <h3>2.2 Configure for Testnet</h3>
    <p>Create <code>~/.bitcoin/bitcoin.conf</code>:</p>
    <pre># Testnet Configuration
testnet=1
server=1
txindex=1

# RPC Settings
rpcuser=your_rpc_username
rpcpassword=your_secure_password
rpcport=18332

# Optional: Prune if disk space limited
# prune=550</pre>

    <h3>2.3 Start Bitcoin Core</h3>
    <pre># Start testnet node
bitcoind -testnet -daemon

# Check sync status
bitcoin-cli -testnet getblockchaininfo

# Get testnet coins from faucet
# Visit: https://testnet-faucet.mempool.co</pre>

    <h2 id="lightning-setup">3. Lightning Network Setup</h2>

    <h3>3.1 Install LND</h3>
    <pre># Download LND
wget https://github.com/lightningnetwork/lnd/releases/download/v0.17.0-beta/lnd-linux-amd64-v0.17.0-beta.tar.gz

# Extract
tar -xzf lnd-linux-amd64-v0.17.0-beta.tar.gz

# Install
sudo install -m 0755 -o root -g root -t /usr/local/bin lnd-linux-amd64-v0.17.0-beta/*</pre>

    <h3>3.2 Configure LND</h3>
    <p>Create <code>~/.lnd/lnd.conf</code>:</p>
    <pre># LND Testnet Configuration
[Application Options]
debuglevel=info
maxpendingchannels=10

[Bitcoin]
bitcoin.active=1
bitcoin.testnet=1
bitcoin.node=bitcoind

[Bitcoind]
bitcoind.rpcuser=your_rpc_username
bitcoind.rpcpass=your_secure_password
bitcoind.zmqpubrawblock=tcp://127.0.0.1:28332
bitcoind.zmqpubrawtx=tcp://127.0.0.1:28333</pre>

    <h3>3.3 Start LND</h3>
    <pre># Start LND
lnd

# Create wallet (separate terminal)
lncli create

# Get testnet Lightning address
lncli newaddress p2wkh

# Fund your Lightning wallet with testnet BTC
bitcoin-cli -testnet sendtoaddress YOUR_LND_ADDRESS 0.01

# Wait for confirmation, then open channel
lncli openchannel --node_key NODE_PUBKEY --local_amt 1000000</pre>

    <h2 id="ord-setup">4. Ord Installation & Setup</h2>

    <h3>4.1 Install Ord</h3>
    <pre># Install via cargo (Rust required)
cargo install ord

# Or download binary
wget https://github.com/ordinals/ord/releases/download/0.14.0/ord-0.14.0-x86_64-unknown-linux-gnu.tar.gz
tar -xzf ord-0.14.0-x86_64-unknown-linux-gnu.tar.gz
sudo install -m 0755 ord /usr/local/bin/</pre>

    <h3>4.2 Configure Ord for Testnet</h3>
    <pre># Set testnet mode
export ORD_BITCOIN_RPC_URL=http://localhost:18332
export ORD_BITCOIN_RPC_USERNAME=your_rpc_username
export ORD_BITCOIN_RPC_PASSWORD=your_secure_password

# Create ord wallet
ord --testnet wallet create

# Get receiving address
ord --testnet wallet receive</pre>

    <h2 id="sparkle-inscription">5. Creating Sparkle-Compatible Inscriptions</h2>

    <h3>5.1 Sparkle Metadata Format</h3>
    <p>Create <code>sparkle-nft.json</code>:</p>
    <pre>{
  "p": "sparkle",
  "v": 1,
  "nft": {
    "name": "Test Sparkle NFT",
    "description": "Experimental Sparkle Protocol testnet inscription"
  },
  "lightning": {
    "enabled": true,
    "min_channel_capacity": 100000
  },
  "trade": {
    "fee_rate": 1
  }
}</pre>

    <h3>5.2 Inscribe to Testnet</h3>
    <pre># Inscribe the metadata
ord --testnet wallet inscribe --file sparkle-nft.json --fee-rate 10

# Note the inscription ID from output
# Example: abc123def456...i0

# Check inscription
ord --testnet wallet inscriptions</pre>

    <div class="note">
        <strong>Note:</strong> The inscription ID is critical—this marks the NFT as Sparkle-compatible. Marketplaces would detect this metadata to enable Lightning trading.
    </div>

    <h3>5.3 Multi-File Inscriptions</h3>
    <p>For NFTs with artwork + metadata:</p>
    <pre># 1. Inscribe artwork first
ord --testnet wallet inscribe --file artwork.png --fee-rate 10
# Output: artwork_inscription_id

# 2. Inscribe Sparkle metadata referencing artwork
# Create sparkle-with-parent.json:
{
  "p": "sparkle",
  "v": 1,
  "parent": "artwork_inscription_id",
  "nft": {
    "name": "Artwork with Sparkle",
    "image": "/content/artwork_inscription_id"
  },
  "lightning": {
    "enabled": true
  }
}

# Inscribe metadata
ord --testnet wallet inscribe --file sparkle-with-parent.json --fee-rate 10</pre>

    <h2 id="trading-flow">6. Understanding the Trading Flow</h2>

    <h3>6.1 Conceptual Trade Example</h3>
    <p>Here's how a Sparkle trade would work (coordinator required):</p>

    <div class="definition">
        <strong>Scenario:</strong> Alice wants to sell inscription <code>abc123</code> to Bob for 100,000 sats via Lightning.
    </div>

    <p><strong>Step 1: Trade Initiation</strong></p>
    <pre># Alice lists inscription for sale
# (Requires marketplace UI - not implemented)
{
  "inscription_id": "abc123...i0",
  "price_sats": 100000,
  "seller_lightning_node": "03alice..."
}</pre>

    <p><strong>Step 2: HTLC Creation</strong></p>
    <pre># Coordinator generates payment hash
preimage = randomBytes(32)
payment_hash = sha256(preimage)

# Create Lightning invoice
lncli addinvoice --amt 100000 --memo "Sparkle trade abc123" --hash payment_hash</pre>

    <p><strong>Step 3: PSBT Preparation</strong></p>
    <pre># Alice creates PSBT transferring inscription to Bob
bitcoin-cli -testnet createpsbt \
  '[{"txid":"alice_utxo_txid","vout":0}]' \
  '[{"bob_address":0.00000546}]'

# Alice signs PSBT
bitcoin-cli -testnet signrawtransactionwithwallet PSBT_HEX</pre>

    <p><strong>Step 4: Atomic Settlement</strong></p>
    <pre># Bob pays Lightning invoice
lncli payinvoice INVOICE_STRING

# Coordinator receives payment (locked by hash)
# Coordinator broadcasts PSBT
bitcoin-cli -testnet sendrawtransaction SIGNED_PSBT_HEX

# Coordinator reveals preimage to claim Lightning payment
# Trade complete: Bob gets inscription, Alice gets sats</pre>

    <div class="warning">
        <strong>Warning:</strong> This flow requires a coordinator service that doesn't exist yet. The above steps demonstrate the concept only.
    </div>

    <h2 id="coordinator">7. Coordinator Development (Future)</h2>

    <h3>7.1 Coordinator Responsibilities</h3>
    <p>A Sparkle coordinator would need to:</p>
    <ul>
        <li>Accept trade requests from buyers and sellers</li>
        <li>Create HTLCs with appropriate timeouts</li>
        <li>Verify PSBT signatures and UTXO availability</li>
        <li>Broadcast PSBTs when Lightning payments succeed</li>
        <li>Handle timeout scenarios gracefully</li>
        <li>Monitor blockchain confirmations</li>
    </ul>

    <h3>7.2 Basic Coordinator Pseudocode</h3>
    <pre>class SparkleCoordinator {
  async createTrade(inscription_id, price, seller, buyer) {
    // Generate preimage and hash
    const preimage = randomBytes(32)
    const hash = sha256(preimage)

    // Create Lightning invoice
    const invoice = await this.createInvoice(price, hash)

    // Request PSBT from seller
    const psbt = await this.requestPSBT(seller, inscription_id, buyer)

    // Store trade state
    this.trades[hash] = {
      preimage,
      psbt,
      inscription_id,
      status: 'pending'
    }

    return invoice
  }

  async onPaymentReceived(payment_hash) {
    const trade = this.trades[payment_hash]

    // Broadcast PSBT
    await this.broadcastPSBT(trade.psbt)

    // Reveal preimage to claim payment
    await this.claimPayment(trade.preimage)

    trade.status = 'complete'
  }
}</pre>

    <div class="note">
        <strong>Note:</strong> Actual coordinator implementation requires robust error handling, timeout management, and security measures not shown here.
    </div>

    <h2 id="testing">8. Testing & Verification</h2>

    <h3>8.1 Verify Inscription Metadata</h3>
    <pre># Check inscription content
ord --testnet wallet inscription INSCRIPTION_ID

# Verify Sparkle metadata is present
# Should contain: "p": "sparkle"</pre>

    <h3>8.2 Test Lightning Payments</h3>
    <pre># Create test invoice
lncli addinvoice --amt 1000 --memo "Test payment"

# Pay invoice (from another node or testnet wallet)
lncli payinvoice PAYMENT_REQUEST

# Verify payment
lncli listinvoices</pre>

    <h3>8.3 Verify Bitcoin Transactions</h3>
    <pre># Create and broadcast PSBT manually
bitcoin-cli -testnet createpsbt ...
bitcoin-cli -testnet signrawtransactionwithwallet ...
bitcoin-cli -testnet sendrawtransaction ...

# Check transaction status
bitcoin-cli -testnet gettransaction TXID</pre>

    <h2 id="troubleshooting">9. Common Issues & Solutions</h2>

    <h3>9.1 Bitcoin Core Issues</h3>
    <p><strong>Problem:</strong> "Cannot connect to Bitcoin Core"</p>
    <pre># Solution: Check Bitcoin Core is running
bitcoin-cli -testnet getblockchaininfo

# Verify RPC credentials in bitcoin.conf</pre>

    <h3>9.2 Lightning Network Issues</h3>
    <p><strong>Problem:</strong> "Insufficient channel capacity"</p>
    <pre># Solution: Open larger channel or multiple channels
lncli openchannel --node_key PUBKEY --local_amt 5000000

# Check current channels
lncli listchannels</pre>

    <h3>9.3 Ord Issues</h3>
    <p><strong>Problem:</strong> "Insufficient funds for inscription"</p>
    <pre># Solution: Fund ord wallet
bitcoin-cli -testnet sendtoaddress ORD_ADDRESS 0.001

# Check ord wallet balance
ord --testnet wallet balance</pre>

    <h2 id="next-steps">10. Next Steps</h2>

    <h3>10.1 For Developers</h3>
    <ul>
        <li>Review the <a href="developer-sdk.html">SDK documentation</a></li>
        <li>Study <a href="technical-reality.html">technical analysis</a></li>
        <li>Experiment with testnet inscriptions</li>
        <li>Build proof-of-concept coordinator</li>
        <li>Provide feedback on specification</li>
    </ul>

    <h3>10.2 For Researchers</h3>
    <ul>
        <li>Analyze <a href="formal-proofs.html">security properties</a></li>
        <li>Test edge cases and failure scenarios</li>
        <li>Review economic incentives</li>
        <li>Suggest protocol improvements</li>
    </ul>

    <h3>10.3 For Users</h3>
    <ul>
        <li>Learn about <a href="whitepaper.html">protocol design</a></li>
        <li>Understand <a href="protocol-comparison.html">trade-offs</a></li>
        <li>Wait for production implementations</li>
        <li>Do not use on mainnet until audited</li>
    </ul>

    <div class="warning">
        <strong>Final Warning:</strong> This guide is for educational and testing purposes only. Sparkle Protocol is experimental and unaudited. Do not use real funds. Always test on testnet first.
    </div>

    <h2 id="resources">11. Additional Resources</h2>

    <h3>11.1 Testnet Faucets</h3>
    <ul>
        <li>Bitcoin Testnet: <a href="https://testnet-faucet.mempool.co">https://testnet-faucet.mempool.co</a></li>
        <li>Lightning Testnet: <a href="https://faucet.lightning.community">https://faucet.lightning.community</a></li>
    </ul>

    <h3>11.2 Documentation</h3>
    <ul>
        <li>Bitcoin Core: <a href="https://bitcoin.org/en/bitcoin-core/">https://bitcoin.org/en/bitcoin-core/</a></li>
        <li>LND: <a href="https://docs.lightning.engineering">https://docs.lightning.engineering</a></li>
        <li>Ord: <a href="https://docs.ordinals.com">https://docs.ordinals.com</a></li>
        <li>Lightning BOLTs: <a href="https://github.com/lightning/bolts">https://github.com/lightning/bolts</a></li>
    </ul>

    <h3>11.3 Community</h3>
    <ul>
        <li>GitHub: <a href="https://github.com/ProtocolSparkle/Sparkles-Protocol">github.com/ProtocolSparkle/Sparkles-Protocol</a></li>
        <li>X / Twitter: <a href="https://x.com/SparkleProtocol">@SparkleProtocol</a></li>
        <li>Issues: <a href="https://github.com/ProtocolSparkle/Sparkles-Protocol/issues">Report bugs or suggest features</a></li>
    </ul>

    <footer class="document-footer">
        <p>Sparkle Protocol v0.3.0 | Core Protocol Implemented</p>
        <p><a href="https://github.com/ProtocolSparkle/Sparkles-Protocol">GitHub</a> | <a href="https://x.com/SparkleProtocol">X/Twitter</a> | <a href="swap.html">Taproot Swap</a></p>
    </footer>
        
            <section class="related-docs">
                <h2>Related Documents</h2>
                <ul>
                    <li><a href="recursive-inscriptions-guide.html">Recursive Inscriptions Guide</a> – Working code examples</li>
                    <li><a href="developer-sdk.html">Developer SDK</a> – API reference</li>
                    <li><a href="darkita-case-study.html">DARKITA Case Study</a> – Real implementation example</li>
                    <li><a href="alternatives.html">Alternative Protocols</a> – What to use in production</li>
                    <li><a href="docs/sip-3.html">SIP-3 Specification</a> – Protocol details</li>
                </ul>
            </section>
        </article>
    </main>

    <script src="js/main-academic.js"></script>
</body>
</html>
