var Ti=Object.defineProperty;var vi=(t,e,r)=>e in t?Ti(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Y=(t,e)=>()=>(t&&(e=t(t=0)),e);var Kt=(t,e,r)=>vi(t,typeof e!="symbol"?e+"":e,r);var ee,To=Y(()=>{ee=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0});function ne(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ve(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function xt(t,...e){if(!ne(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function rn(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");ve(t.outputLen),ve(t.blockLen)}function le(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Uo(t,e){xt(t);let r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Bt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function on(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Et(t,e){return t<<32-e|t>>>e}function Ue(t,e){return t<<e|t>>>32-e>>>0}function et(t){if(xt(t),Po)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=Ui[t[r]];return e}function vo(t){if(t>=It._0&&t<=It._9)return t-It._0;if(t>=It.A&&t<=It.F)return t-(It.A-10);if(t>=It.a&&t<=It.f)return t-(It.a-10)}function kt(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Po)return Uint8Array.fromHex(t);let e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=vo(t.charCodeAt(s)),c=vo(t.charCodeAt(s+1));if(i===void 0||c===void 0){let a=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+a+'" at index '+s)}n[o]=i*16+c}return n}function sn(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Pe(t){return typeof t=="string"&&(t=sn(t)),xt(t),t}function lt(...t){let e=0;for(let n=0;n<t.length;n++){let o=t[n];xt(o),e+=o.length}let r=new Uint8Array(e);for(let n=0,o=0;n<t.length;n++){let s=t[n];r.set(s,o),o+=s.length}return r}function cn(t){let e=n=>t().update(Pe(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Nt(t=32){if(ee&&typeof ee.getRandomValues=="function")return ee.getRandomValues(new Uint8Array(t));if(ee&&typeof ee.randomBytes=="function")return Uint8Array.from(ee.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}var Po,Ui,It,fe,ht=Y(()=>{To();Po=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Ui=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));It={_0:48,_9:57,A:65,F:70,a:97,f:102};fe=class{}});function Pi(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),c=Number(r&s),a=n?4:0,u=n?0:4;t.setUint32(e+a,i,n),t.setUint32(e+u,c,n)}function or(t,e,r){return t&e^~t&r}function sr(t,e,r){return t&e^t&r^e&r}var de,Lt,ir=Y(()=>{ht();de=class extends fe{constructor(e,r,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(e),this.view=on(this.buffer)}update(e){le(this),e=Pe(e),xt(e);let{view:r,buffer:n,blockLen:o}=this,s=e.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let a=on(e);for(;o<=s-i;i+=o)this.process(a,i);continue}n.set(e.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){le(this),Uo(e,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,Bt(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let d=i;d<o;d++)r[d]=0;Pi(n,o-8,BigInt(this.length*8),s),this.process(n,0);let c=on(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=a/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)c.setUint32(4*d,l[d],s)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:c}=this;return e.destroyed=i,e.finished=s,e.length=o,e.pos=c,o%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}},Lt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225])});var Ii,qt,an,F,un=Y(()=>{ir();ht();Ii=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),qt=new Uint32Array(64),an=class extends de{constructor(e=32){super(64,e,8,!1),this.A=Lt[0]|0,this.B=Lt[1]|0,this.C=Lt[2]|0,this.D=Lt[3]|0,this.E=Lt[4]|0,this.F=Lt[5]|0,this.G=Lt[6]|0,this.H=Lt[7]|0}get(){let{A:e,B:r,C:n,D:o,E:s,F:i,G:c,H:a}=this;return[e,r,n,o,s,i,c,a]}set(e,r,n,o,s,i,c,a){this.A=e|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(e,r){for(let d=0;d<16;d++,r+=4)qt[d]=e.getUint32(r,!1);for(let d=16;d<64;d++){let f=qt[d-15],p=qt[d-2],w=Et(f,7)^Et(f,18)^f>>>3,b=Et(p,17)^Et(p,19)^p>>>10;qt[d]=b+qt[d-7]+w+qt[d-16]|0}let{A:n,B:o,C:s,D:i,E:c,F:a,G:u,H:l}=this;for(let d=0;d<64;d++){let f=Et(c,6)^Et(c,11)^Et(c,25),p=l+f+or(c,a,u)+Ii[d]+qt[d]|0,b=(Et(n,2)^Et(n,13)^Et(n,22))+sr(n,o,s)|0;l=u,u=a,a=c,c=i+p|0,i=s,s=o,o=n,n=p+b|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,o,s,i,c,a,u,l)}roundClean(){Bt(qt)}destroy(){this.set(0,0,0,0,0,0,0,0),Bt(this.buffer)}},F=cn(()=>new an)});var fn,cr=Y(()=>{un();fn=F});function pe(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ni(t,...e){if(!pe(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Co(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function fr(t){if(typeof t!="function")throw new Error("function expected");return!0}function he(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function Ne(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function dn(t){if(!Array.isArray(t))throw new Error("array expected")}function Ho(t,e){if(!Co(!0,e))throw new Error(`${t}: array of strings expected`)}function lr(t,e){if(!Co(!1,e))throw new Error(`${t}: array of numbers expected`)}function hn(...t){let e=s=>s,r=(s,i)=>c=>s(i(c)),n=t.map(s=>s.encode).reduceRight(r,e),o=t.map(s=>s.decode).reduce(r,e);return{encode:n,decode:o}}function dr(t){let e=typeof t=="string"?t.split(""):t,r=e.length;Ho("alphabet",e);let n=new Map(e.map((o,s)=>[o,s]));return{encode:o=>(dn(o),o.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:o=>(dn(o),o.map(s=>{he("alphabet.decode",s);let i=n.get(s);if(i===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return i}))}}function pr(t=""){return he("join",t),{encode:e=>(Ho("join.decode",e),e.join(t)),decode:e=>(he("join.decode",e),e.split(t))}}function Li(t){return fr(t),{encode:e=>e,decode:e=>t(e)}}function Io(t,e,r){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: invalid to=${r}, base cannot be less than 2`);if(dn(t),!t.length)return[];let n=0,o=[],s=Array.from(t,c=>{if(Ne(c),c<0||c>=e)throw new Error(`invalid integer: ${c}`);return c}),i=s.length;for(;;){let c=0,a=!0;for(let u=n;u<i;u++){let l=s[u],d=e*c,f=d+l;if(!Number.isSafeInteger(f)||d/e!==c||f-l!==d)throw new Error("convertRadix: carry overflow");let p=f/r;c=f%r;let w=Math.floor(p);if(s[u]=w,!Number.isSafeInteger(w)||w*r+c!==f)throw new Error("convertRadix: carry overflow");if(a)w?a=!1:n=u;else continue}if(o.push(c),a)break}for(let c=0;c<t.length-1&&t[c]===0;c++)o.push(0);return o.reverse()}function ar(t,e,r,n){if(dn(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(pn(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${pn(e,r)}`);let o=0,s=0,i=ln[e],c=ln[r]-1,a=[];for(let u of t){if(Ne(u),u>=i)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(o=o<<e|u,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=r;s-=r)a.push((o>>s-r&c)>>>0);let l=ln[s];if(l===void 0)throw new Error("invalid carry");o&=l-1}if(o=o<<r-s&c,!n&&s>=e)throw new Error("Excess padding");if(!n&&o>0)throw new Error(`Non-zero padding: ${o}`);return n&&s>0&&a.push(o>>>0),a}function Ri(t){Ne(t);let e=2**8;return{encode:r=>{if(!pe(r))throw new Error("radix.encode input should be Uint8Array");return Io(Array.from(r),e,t)},decode:r=>(lr("radix.decode",r),Uint8Array.from(Io(r,t,e)))}}function $o(t,e=!1){if(Ne(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(pn(8,t)>32||pn(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!pe(r))throw new Error("radix2.encode input should be Uint8Array");return ar(Array.from(r),8,t,!e)},decode:r=>(lr("radix2.decode",r),Uint8Array.from(ar(r,t,8,e)))}}function No(t){return fr(t),function(...e){try{return t.apply(null,e)}catch{}}}function Ci(t,e){return Ne(t),fr(e),{encode(r){if(!pe(r))throw new Error("checksum.encode: input should be Uint8Array");let n=e(r).slice(0,t),o=new Uint8Array(r.length+t);return o.set(r),o.set(n,r.length),o},decode(r){if(!pe(r))throw new Error("checksum.decode: input should be Uint8Array");let n=r.slice(0,-t),o=r.slice(-t),s=e(n).slice(0,t);for(let i=0;i<t;i++)if(s[i]!==o[i])throw new Error("Invalid checksum");return n}}}function Ie(t){let e=t>>25,r=(t&33554431)<<5;for(let n=0;n<Lo.length;n++)(e>>n&1)===1&&(r^=Lo[n]);return r}function Ro(t,e,r=1){let n=t.length,o=1;for(let s=0;s<n;s++){let i=t.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${t})`);o=Ie(o)^i>>5}o=Ie(o);for(let s=0;s<n;s++)o=Ie(o)^t.charCodeAt(s)&31;for(let s of e)o=Ie(o)^s;for(let s=0;s<6;s++)o=Ie(o);return o^=r,ur.encode(ar([o%ln[30]],30,5,!1))}function Do(t){let e=t==="bech32"?1:734539939,r=$o(5),n=r.decode,o=r.encode,s=No(n);function i(d,f,p=90){he("bech32.encode prefix",d),pe(f)&&(f=Array.from(f)),lr("bech32.encode",f);let w=d.length;if(w===0)throw new TypeError(`Invalid prefix length ${w}`);let b=w+7+f.length;if(p!==!1&&b>p)throw new TypeError(`Length ${b} exceeds limit ${p}`);let m=d.toLowerCase(),S=Ro(m,f,e);return`${m}1${ur.encode(f)}${S}`}function c(d,f=90){he("bech32.decode input",d);let p=d.length;if(p<8||f!==!1&&p>f)throw new TypeError(`invalid string length: ${p} (${d}). Expected (8..${f})`);let w=d.toLowerCase();if(d!==w&&d!==d.toUpperCase())throw new Error("String must be lowercase or uppercase");let b=w.lastIndexOf("1");if(b===0||b===-1)throw new Error('Letter "1" must be present between prefix and data only');let m=w.slice(0,b),S=w.slice(b+1);if(S.length<6)throw new Error("Data must be at least 6 characters long");let U=ur.decode(S).slice(0,-6),v=Ro(m,U,e);if(!S.endsWith(v))throw new Error(`Invalid checksum in ${d}: expected "${v}"`);return{prefix:m,words:U}}let a=No(c);function u(d){let{prefix:f,words:p}=c(d,!1);return{prefix:f,words:p,bytes:n(p)}}function l(d,f){return i(d,o(f))}return{encode:i,decode:c,encodeFromBytes:l,decodeToBytes:u,decodeUnsafe:a,fromWords:n,fromWordsUnsafe:s,toWords:o}}var _o,pn,ln,Hi,_i,Wo,ur,Lo,wn,hr,Oo,$i,Wi,H,Le=Y(()=>{_o=(t,e)=>e===0?t:_o(e,t%e),pn=(t,e)=>t+(e-_o(t,e)),ln=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();Hi=t=>hn(Ri(58),dr(t),pr("")),_i=Hi("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Wo=t=>hn(Ci(4,e=>t(t(e))),_i),ur=hn(dr("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),pr("")),Lo=[996825010,642813549,513874426,1027748829,705979059];wn=Do("bech32"),hr=Do("bech32m"),Oo={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},$i=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Wi={encode(t){return Ni(t),t.toHex()},decode(t){return he("hex",t),Uint8Array.fromHex(t)}},H=$i?Wi:hn($o(4),dr("0123456789abcdef"),pr(""),Li(t=>{if(typeof t!="string"||t.length%2!==0)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()}))});var gn,wr,Mo=Y(()=>{ht();gn=class extends fe{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,rn(e);let n=Pe(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?e.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=e.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),Bt(s)}update(e){return le(this),this.iHash.update(e),this}digestInto(e){le(this),xt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return e=e,e.finished=o,e.destroyed=s,e.blockLen=i,e.outputLen=c,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},wr=(t,e,r)=>new gn(t,e).update(r).digest();wr.create=(t,e)=>new gn(t,e)});function Re(t,e=""){if(typeof t!="boolean"){let r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function Yt(t,e,r=""){let n=ne(t),o=t?.length,s=e!==void 0;if(!n||s&&o!==e){let i=r&&`"${r}" `,c=s?` of length ${e}`:"",a=n?`length=${o}`:`type=${typeof t}`;throw new Error(i+"expected Uint8Array"+c+", got "+a)}return t}function Ce(t){let e=t.toString(16);return e.length&1?"0"+e:e}function Vo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?br:BigInt("0x"+t)}function Rt(t){return Vo(et(t))}function mr(t){return xt(t),Vo(et(Uint8Array.from(t).reverse()))}function we(t,e){return kt(t.toString(16).padStart(e*2,"0"))}function xr(t,e){return we(t,e).reverse()}function z(t,e,r){let n;if(typeof e=="string")try{n=kt(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(ne(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let o=n.length;if(typeof r=="number"&&o!==r)throw new Error(t+" of length "+r+" expected, got "+o);return n}function He(t,e,r){return gr(t)&&gr(e)&&gr(r)&&e<=t&&t<r}function Ko(t,e,r,n){if(!He(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function yn(t){let e;for(e=0;t>br;t>>=yr,e+=1);return e}function qo(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=p=>new Uint8Array(p),o=p=>Uint8Array.of(p),s=n(t),i=n(t),c=0,a=()=>{s.fill(1),i.fill(0),c=0},u=(...p)=>r(i,s,...p),l=(p=n(0))=>{i=u(o(0),p),s=u(),p.length!==0&&(i=u(o(1),p),s=u())},d=()=>{if(c++>=1e3)throw new Error("drbg: tried 1000 values");let p=0,w=[];for(;p<e;){s=u();let b=s.slice();w.push(b),p+=s.length}return lt(...w)};return(p,w)=>{a(),l(p);let b;for(;!(b=w(d()));)l();return a(),b}}function _e(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(o,s,i){let c=t[o];if(i&&c===void 0)return;let a=typeof c;if(a!==s||c===null)throw new Error(`param "${o}" is invalid: expected ${s}, got ${a}`)}Object.entries(e).forEach(([o,s])=>n(o,s,!1)),Object.entries(r).forEach(([o,s])=>n(o,s,!0))}function Er(t){let e=new WeakMap;return(r,...n)=>{let o=e.get(r);if(o!==void 0)return o;let s=t(r,...n);return e.set(r,s),s}}var br,yr,gr,zt,$e=Y(()=>{ht();ht();br=BigInt(0),yr=BigInt(1);gr=t=>typeof t=="bigint"&&br<=t;zt=t=>(yr<<BigInt(t))-yr});function wt(t,e){let r=t%e;return r>=ut?r:e+r}function gt(t,e,r){let n=t;for(;e-- >ut;)n*=n,n%=r;return n}function Yo(t,e){if(t===ut)throw new Error("invert: expected non-zero number");if(e<=ut)throw new Error("invert: expected positive modulus, got "+e);let r=wt(t,e),n=e,o=ut,s=st,i=st,c=ut;for(;r!==ut;){let u=n/r,l=n%r,d=o-i*u,f=s-c*u;n=r,r=l,o=i,s=c,i=d,c=f}if(n!==st)throw new Error("invert: does not exist");return wt(o,e)}function Sr(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function Qo(t,e){let r=(t.ORDER+st)/Fo,n=t.pow(e,r);return Sr(t,n,e),n}function Ki(t,e){let r=(t.ORDER-jo)/Zo,n=t.mul(e,re),o=t.pow(n,r),s=t.mul(e,o),i=t.mul(t.mul(s,re),o),c=t.mul(s,t.sub(i,t.ONE));return Sr(t,c,e),c}function qi(t){let e=Gt(t),r=Jo(t),n=r(e,e.neg(e.ONE)),o=r(e,n),s=r(e,e.neg(n)),i=(t+Mi)/Xo;return(c,a)=>{let u=c.pow(a,i),l=c.mul(u,n),d=c.mul(u,o),f=c.mul(u,s),p=c.eql(c.sqr(l),a),w=c.eql(c.sqr(d),a);u=c.cmov(u,l,p),l=c.cmov(f,d,w);let b=c.eql(c.sqr(l),a),m=c.cmov(u,l,b);return Sr(c,m,a),m}}function Jo(t){if(t<Go)throw new Error("sqrt is not defined for small field");let e=t-st,r=0;for(;e%re===ut;)e/=re,r++;let n=re,o=Gt(t);for(;zo(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Qo;let s=o.pow(n,e),i=(e+st)/re;return function(a,u){if(a.is0(u))return u;if(zo(a,u)!==1)throw new Error("Cannot find square root");let l=r,d=a.mul(a.ONE,s),f=a.pow(u,e),p=a.pow(u,i);for(;!a.eql(f,a.ONE);){if(a.is0(f))return a.ZERO;let w=1,b=a.sqr(f);for(;!a.eql(b,a.ONE);)if(w++,b=a.sqr(b),w===l)throw new Error("Cannot find square root");let m=st<<BigInt(l-w-1),S=a.pow(d,m);l=w,d=a.sqr(S),f=a.mul(f,d),p=a.mul(p,S)}return p}}function Yi(t){return t%Fo===Go?Qo:t%Zo===jo?Ki:t%Xo===Vi?qi(t):Jo(t)}function Ar(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=zi.reduce((n,o)=>(n[o]="function",n),e);return _e(t,r),t}function Gi(t,e,r){if(r<ut)throw new Error("invalid exponent, negatives unsupported");if(r===ut)return t.ONE;if(r===st)return e;let n=t.ONE,o=e;for(;r>ut;)r&st&&(n=t.mul(n,o)),o=t.sqr(o),r>>=st;return n}function bn(t,e,r=!1){let n=new Array(e.length).fill(r?t.ZERO:void 0),o=e.reduce((i,c,a)=>t.is0(c)?i:(n[a]=i,t.mul(i,c)),t.ONE),s=t.inv(o);return e.reduceRight((i,c,a)=>t.is0(c)?i:(n[a]=t.mul(i,n[a]),t.mul(i,c)),s),n}function zo(t,e){let r=(t.ORDER-st)/re,n=t.pow(e,r),o=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),i=t.eql(n,t.neg(t.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function mn(t,e){e!==void 0&&ve(e);let r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Gt(t,e,r=!1,n={}){if(t<=ut)throw new Error("invalid field: expected ORDER > 0, got "+t);let o,s,i=!1,c;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");let f=e;f.BITS&&(o=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(i=f.modFromBytes),c=f.allowedLengths}else typeof e=="number"&&(o=e),n.sqrt&&(s=n.sqrt);let{nBitLength:a,nByteLength:u}=mn(t,o);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l,d=Object.freeze({ORDER:t,isLE:r,BITS:a,BYTES:u,MASK:zt(a),ZERO:ut,ONE:st,allowedLengths:c,create:f=>wt(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return ut<=f&&f<t},is0:f=>f===ut,isValidNot0:f=>!d.is0(f)&&d.isValid(f),isOdd:f=>(f&st)===st,neg:f=>wt(-f,t),eql:(f,p)=>f===p,sqr:f=>wt(f*f,t),add:(f,p)=>wt(f+p,t),sub:(f,p)=>wt(f-p,t),mul:(f,p)=>wt(f*p,t),pow:(f,p)=>Gi(d,f,p),div:(f,p)=>wt(f*Yo(p,t),t),sqrN:f=>f*f,addN:(f,p)=>f+p,subN:(f,p)=>f-p,mulN:(f,p)=>f*p,inv:f=>Yo(f,t),sqrt:s||(f=>(l||(l=Yi(t)),l(d,f))),toBytes:f=>r?xr(f,u):we(f,u),fromBytes:(f,p=!0)=>{if(c){if(!c.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+f.length);let b=new Uint8Array(u);b.set(f,r?0:b.length-f.length),f=b}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let w=r?mr(f):Rt(f);if(i&&(w=wt(w,t)),!p&&!d.isValid(w))throw new Error("invalid field element: outside of range 0..ORDER");return w},invertBatch:f=>bn(d,f),cmov:(f,p,w)=>w?p:f});return Object.freeze(d)}function ts(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function Br(t){let e=ts(t);return e+Math.ceil(e/2)}function xn(t,e,r=!1){let n=t.length,o=ts(e),s=Br(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?mr(t):Rt(t),c=wt(i,e-st)+st;return r?xr(c,o):we(c,o)}var ut,st,re,Go,Fo,jo,Mi,Zo,Vi,Xo,zi,En=Y(()=>{$e();ut=BigInt(0),st=BigInt(1),re=BigInt(2),Go=BigInt(3),Fo=BigInt(4),jo=BigInt(5),Mi=BigInt(7),Zo=BigInt(8),Vi=BigInt(9),Xo=BigInt(16);zi=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"]});function We(t,e){let r=e.negate();return t?r:e}function An(t,e){let r=bn(t.Fp,e.map(n=>n.Z));return e.map((n,o)=>t.fromAffine(n.toAffine(r[o])))}function os(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function kr(t,e){os(t,e);let r=Math.ceil(e/t)+1,n=2**(t-1),o=2**t,s=zt(t),i=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function es(t,e,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,c=Number(t&o),a=t>>i;c>n&&(c-=s,a+=oe);let u=e*n,l=u+Math.abs(c)-1,d=c===0,f=c<0,p=e%2!==0;return{nextN:a,offset:l,isZero:d,isNeg:f,isNegF:p,offsetF:u}}function Fi(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function ji(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}function vr(t){return ss.get(t)||1}function ns(t){if(t!==ge)throw new Error("invalid wNAF")}function is(t,e,r,n){let o=e,s=t.ZERO,i=t.ZERO;for(;r>ge||n>ge;)r&oe&&(s=s.add(o)),n&oe&&(i=i.add(o)),o=o.double(),r>>=oe,n>>=oe;return{p1:s,p2:i}}function cs(t,e,r,n){Fi(r,t),ji(n,e);let o=r.length,s=n.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");let i=t.ZERO,c=yn(BigInt(o)),a=1;c>12?a=c-3:c>4?a=c-2:c>0&&(a=2);let u=zt(a),l=new Array(Number(u)+1).fill(i),d=Math.floor((e.BITS-1)/a)*a,f=i;for(let p=d;p>=0;p-=a){l.fill(i);for(let b=0;b<s;b++){let m=n[b],S=Number(m>>BigInt(p)&u);l[S]=l[S].add(r[b])}let w=i;for(let b=l.length-1,m=i;b>0;b--)m=m.add(l[b]),w=w.add(m);if(f=f.add(w),p!==0)for(let b=0;b<a;b++)f=f.double()}return f}function rs(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Ar(e),e}else return Gt(t,{isLE:r})}function as(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(let a of["p","n","h"]){let u=e[a];if(!(typeof u=="bigint"&&u>ge))throw new Error(`CURVE.${a} must be positive bigint`)}let o=rs(e.p,r.Fp,n),s=rs(e.n,r.Fn,n),c=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(let a of c)if(!o.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:o,Fn:s}}var ge,oe,Tr,ss,Sn,us=Y(()=>{$e();En();ge=BigInt(0),oe=BigInt(1);Tr=new WeakMap,ss=new WeakMap;Sn=class{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let o=e;for(;r>ge;)r&oe&&(n=n.add(o)),o=o.double(),r>>=oe;return n}precomputeWindow(e,r){let{windows:n,windowSize:o}=kr(r,this.bits),s=[],i=e,c=i;for(let a=0;a<n;a++){c=i,s.push(c);for(let u=1;u<o;u++)c=c.add(i),s.push(c);i=c.double()}return s}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=kr(e,this.bits);for(let c=0;c<i.windows;c++){let{nextN:a,offset:u,isZero:l,isNeg:d,isNegF:f,offsetF:p}=es(n,c,i);n=a,l?s=s.add(We(f,r[p])):o=o.add(We(d,r[u]))}return ns(n),{p:o,f:s}}wNAFUnsafe(e,r,n,o=this.ZERO){let s=kr(e,this.bits);for(let i=0;i<s.windows&&n!==ge;i++){let{nextN:c,offset:a,isZero:u,isNeg:l}=es(n,i,s);if(n=c,!u){let d=r[a];o=o.add(l?d.negate():d)}}return ns(n),o}getPrecomputes(e,r,n){let o=Tr.get(r);return o||(o=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(o=n(o)),Tr.set(r,o))),o}cached(e,r,n){let o=vr(e);return this.wNAF(o,this.getPrecomputes(o,e,n),r)}unsafe(e,r,n,o){let s=vr(e);return s===1?this._unsafeLadder(e,r,o):this.wNAFUnsafe(s,this.getPrecomputes(s,e,n),r,o)}createCache(e,r){os(r,this.bits),ss.set(e,r),Tr.delete(e)}hasCache(e){return vr(e)!==1}}});function Zi(t,e,r){let[[n,o],[s,i]]=e,c=fs(i*t,r),a=fs(-o*t,r),u=t-c*n-a*s,l=-c*o-a*i,d=u<Ht,f=l<Ht;d&&(u=-u),f&&(l=-l);let p=zt(Math.ceil(yn(r)/2))+ye;if(u<Ht||u>=p||l<Ht||l>=p)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:d,k1:u,k2neg:f,k2:l}}function Pr(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Ur(t,e){let r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return Re(r.lowS,"lowS"),Re(r.prehash,"prehash"),r.format!==void 0&&Pr(r.format),r}function Ft(t,e){let{BYTES:r}=t,n;if(typeof e=="bigint")n=e;else{let o=z("private key",e);try{n=t.fromBytes(o)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function Qi(t,e={}){let r=as("weierstrass",t,e),{Fp:n,Fn:o}=r,s=r.CURVE,{h:i,n:c}=s;_e(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:a}=e;if(a&&(!n.is0(s.a)||typeof a.beta!="bigint"||!Array.isArray(a.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let u=ps(n,o);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function d(C,y,g){let{x:h,y:x}=y.toAffine(),E=n.toBytes(h);if(Re(g,"isCompressed"),g){l();let k=!n.isOdd(x);return lt(ds(k),E)}else return lt(Uint8Array.of(4),E,n.toBytes(x))}function f(C){Yt(C,void 0,"Point");let{publicKey:y,publicKeyUncompressed:g}=u,h=C.length,x=C[0],E=C.subarray(1);if(h===y&&(x===2||x===3)){let k=n.fromBytes(E);if(!n.isValid(k))throw new Error("bad point: is not on curve, wrong x");let B=b(k),A;try{A=n.sqrt(B)}catch(Z){let D=Z instanceof Error?": "+Z.message:"";throw new Error("bad point: is not on curve, sqrt error"+D)}l();let T=n.isOdd(A);return(x&1)===1!==T&&(A=n.neg(A)),{x:k,y:A}}else if(h===g&&x===4){let k=n.BYTES,B=n.fromBytes(E.subarray(0,k)),A=n.fromBytes(E.subarray(k,k*2));if(!m(B,A))throw new Error("bad point: is not on curve");return{x:B,y:A}}else throw new Error(`bad point: got length ${h}, expected compressed=${y} or uncompressed=${g}`)}let p=e.toBytes||d,w=e.fromBytes||f;function b(C){let y=n.sqr(C),g=n.mul(y,C);return n.add(n.add(g,n.mul(C,s.a)),s.b)}function m(C,y){let g=n.sqr(y),h=b(C);return n.eql(g,h)}if(!m(s.Gx,s.Gy))throw new Error("bad curve params: generator point");let S=n.mul(n.pow(s.a,Bn),Xi),U=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(S,U)))throw new Error("bad curve params: a or b");function v(C,y,g=!1){if(!n.isValid(y)||g&&n.is0(y))throw new Error(`bad point coordinate ${C}`);return y}function W(C){if(!(C instanceof I))throw new Error("ProjectivePoint expected")}function L(C){if(!a||!a.basises)throw new Error("no endo");return Zi(C,a.basises,o.ORDER)}let pt=Er((C,y)=>{let{X:g,Y:h,Z:x}=C;if(n.eql(x,n.ONE))return{x:g,y:h};let E=C.is0();y==null&&(y=E?n.ONE:n.inv(x));let k=n.mul(g,y),B=n.mul(h,y),A=n.mul(x,y);if(E)return{x:n.ZERO,y:n.ZERO};if(!n.eql(A,n.ONE))throw new Error("invZ was invalid");return{x:k,y:B}}),ue=Er(C=>{if(C.is0()){if(e.allowInfinityPoint&&!n.is0(C.Y))return;throw new Error("bad point: ZERO")}let{x:y,y:g}=C.toAffine();if(!n.isValid(y)||!n.isValid(g))throw new Error("bad point: x or y not field elements");if(!m(y,g))throw new Error("bad point: equation left != right");if(!C.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function Vt(C,y,g,h,x){return g=new I(n.mul(g.X,C),g.Y,g.Z),y=We(h,y),g=We(x,g),y.add(g)}class I{constructor(y,g,h){this.X=v("x",y),this.Y=v("y",g,!0),this.Z=v("z",h),Object.freeze(this)}static CURVE(){return s}static fromAffine(y){let{x:g,y:h}=y||{};if(!y||!n.isValid(g)||!n.isValid(h))throw new Error("invalid affine point");if(y instanceof I)throw new Error("projective point not allowed");return n.is0(g)&&n.is0(h)?I.ZERO:new I(g,h,n.ONE)}static fromBytes(y){let g=I.fromAffine(w(Yt(y,void 0,"point")));return g.assertValidity(),g}static fromHex(y){return I.fromBytes(z("pointHex",y))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(y=8,g=!0){return te.createCache(this,y),g||this.multiply(Bn),this}assertValidity(){ue(this)}hasEvenY(){let{y}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(y)}equals(y){W(y);let{X:g,Y:h,Z:x}=this,{X:E,Y:k,Z:B}=y,A=n.eql(n.mul(g,B),n.mul(E,x)),T=n.eql(n.mul(h,B),n.mul(k,x));return A&&T}negate(){return new I(this.X,n.neg(this.Y),this.Z)}double(){let{a:y,b:g}=s,h=n.mul(g,Bn),{X:x,Y:E,Z:k}=this,B=n.ZERO,A=n.ZERO,T=n.ZERO,P=n.mul(x,x),Z=n.mul(E,E),D=n.mul(k,k),N=n.mul(x,E);return N=n.add(N,N),T=n.mul(x,k),T=n.add(T,T),B=n.mul(y,T),A=n.mul(h,D),A=n.add(B,A),B=n.sub(Z,A),A=n.add(Z,A),A=n.mul(B,A),B=n.mul(N,B),T=n.mul(h,T),D=n.mul(y,D),N=n.sub(P,D),N=n.mul(y,N),N=n.add(N,T),T=n.add(P,P),P=n.add(T,P),P=n.add(P,D),P=n.mul(P,N),A=n.add(A,P),D=n.mul(E,k),D=n.add(D,D),P=n.mul(D,N),B=n.sub(B,P),T=n.mul(D,Z),T=n.add(T,T),T=n.add(T,T),new I(B,A,T)}add(y){W(y);let{X:g,Y:h,Z:x}=this,{X:E,Y:k,Z:B}=y,A=n.ZERO,T=n.ZERO,P=n.ZERO,Z=s.a,D=n.mul(s.b,Bn),N=n.mul(g,E),K=n.mul(h,k),X=n.mul(x,B),ft=n.add(g,h),q=n.add(E,k);ft=n.mul(ft,q),q=n.add(N,K),ft=n.sub(ft,q),q=n.add(g,x);let ot=n.add(E,B);return q=n.mul(q,ot),ot=n.add(N,X),q=n.sub(q,ot),ot=n.add(h,x),A=n.add(k,B),ot=n.mul(ot,A),A=n.add(K,X),ot=n.sub(ot,A),P=n.mul(Z,q),A=n.mul(D,X),P=n.add(A,P),A=n.sub(K,P),P=n.add(K,P),T=n.mul(A,P),K=n.add(N,N),K=n.add(K,N),X=n.mul(Z,X),q=n.mul(D,q),K=n.add(K,X),X=n.sub(N,X),X=n.mul(Z,X),q=n.add(q,X),N=n.mul(K,q),T=n.add(T,N),N=n.mul(ot,q),A=n.mul(ft,A),A=n.sub(A,N),N=n.mul(ft,K),P=n.mul(ot,P),P=n.add(P,N),new I(A,T,P)}subtract(y){return this.add(y.negate())}is0(){return this.equals(I.ZERO)}multiply(y){let{endo:g}=e;if(!o.isValidNot0(y))throw new Error("invalid scalar: out of range");let h,x,E=k=>te.cached(this,k,B=>An(I,B));if(g){let{k1neg:k,k1:B,k2neg:A,k2:T}=L(y),{p:P,f:Z}=E(B),{p:D,f:N}=E(T);x=Z.add(N),h=Vt(g.beta,P,D,k,A)}else{let{p:k,f:B}=E(y);h=k,x=B}return An(I,[h,x])[0]}multiplyUnsafe(y){let{endo:g}=e,h=this;if(!o.isValid(y))throw new Error("invalid scalar: out of range");if(y===Ht||h.is0())return I.ZERO;if(y===ye)return h;if(te.hasCache(this))return this.multiply(y);if(g){let{k1neg:x,k1:E,k2neg:k,k2:B}=L(y),{p1:A,p2:T}=is(I,h,E,B);return Vt(g.beta,A,T,x,k)}else return te.unsafe(h,y)}multiplyAndAddUnsafe(y,g,h){let x=this.multiplyUnsafe(g).add(y.multiplyUnsafe(h));return x.is0()?void 0:x}toAffine(y){return pt(this,y)}isTorsionFree(){let{isTorsionFree:y}=e;return i===ye?!0:y?y(I,this):te.unsafe(this,c).is0()}clearCofactor(){let{clearCofactor:y}=e;return i===ye?this:y?y(I,this):this.multiplyUnsafe(i)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}toBytes(y=!0){return Re(y,"isCompressed"),this.assertValidity(),p(I,this,y)}toHex(y=!0){return et(this.toBytes(y))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(y=!0){return this.toBytes(y)}_setWindowSize(y){this.precompute(y)}static normalizeZ(y){return An(I,y)}static msm(y,g){return cs(I,o,y,g)}static fromPrivateKey(y){return I.BASE.multiply(Ft(o,y))}}I.BASE=new I(s.Gx,s.Gy,n.ONE),I.ZERO=new I(n.ZERO,n.ONE,n.ZERO),I.Fp=n,I.Fn=o;let en=o.BITS,te=new Sn(I,e.endo?Math.ceil(en/2):en);return I.BASE.precompute(8),I}function ds(t){return Uint8Array.of(t?2:3)}function ps(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function Ji(t,e={}){let{Fn:r}=t,n=e.randomBytes||Nt,o=Object.assign(ps(t.Fp,r),{seed:Br(r.ORDER)});function s(p){try{return!!Ft(r,p)}catch{return!1}}function i(p,w){let{publicKey:b,publicKeyUncompressed:m}=o;try{let S=p.length;return w===!0&&S!==b||w===!1&&S!==m?!1:!!t.fromBytes(p)}catch{return!1}}function c(p=n(o.seed)){return xn(Yt(p,o.seed,"seed"),r.ORDER)}function a(p,w=!0){return t.BASE.multiply(Ft(r,p)).toBytes(w)}function u(p){let w=c(p);return{secretKey:w,publicKey:a(w)}}function l(p){if(typeof p=="bigint")return!1;if(p instanceof t)return!0;let{secretKey:w,publicKey:b,publicKeyUncompressed:m}=o;if(r.allowedLengths||w===b)return;let S=z("key",p).length;return S===b||S===m}function d(p,w,b=!0){if(l(p)===!0)throw new Error("first arg must be private key");if(l(w)===!1)throw new Error("second arg must be public key");let m=Ft(r,p);return t.fromHex(w).multiply(m).toBytes(b)}return Object.freeze({getPublicKey:a,getSharedSecret:d,keygen:u,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:i,randomSecretKey:c,isValidPrivateKey:s,randomPrivateKey:c,normPrivateKeyToScalar:p=>Ft(r,p),precompute(p=8,w=t.BASE){return w.precompute(p,!1)}},lengths:o})}function tc(t,e,r={}){rn(e),_e(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let n=r.randomBytes||Nt,o=r.hmac||((g,...h)=>wr(e,g,lt(...h))),{Fp:s,Fn:i}=t,{ORDER:c,BITS:a}=i,{keygen:u,getPublicKey:l,getSharedSecret:d,utils:f,lengths:p}=Ji(t,r),w={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},b="compact";function m(g){let h=c>>ye;return g>h}function S(g,h){if(!i.isValidNot0(h))throw new Error(`invalid signature ${g}: out of range 1..Point.Fn.ORDER`);return h}function U(g,h){Pr(h);let x=p.signature,E=h==="compact"?x:h==="recovered"?x+1:void 0;return Yt(g,E,`${h} signature`)}class v{constructor(h,x,E){this.r=S("r",h),this.s=S("s",x),E!=null&&(this.recovery=E),Object.freeze(this)}static fromBytes(h,x=b){U(h,x);let E;if(x==="der"){let{r:T,s:P}=Ct.toSig(Yt(h));return new v(T,P)}x==="recovered"&&(E=h[0],x="compact",h=h.subarray(1));let k=i.BYTES,B=h.subarray(0,k),A=h.subarray(k,k*2);return new v(i.fromBytes(B),i.fromBytes(A),E)}static fromHex(h,x){return this.fromBytes(kt(h),x)}addRecoveryBit(h){return new v(this.r,this.s,h)}recoverPublicKey(h){let x=s.ORDER,{r:E,s:k,recovery:B}=this;if(B==null||![0,1,2,3].includes(B))throw new Error("recovery id invalid");if(c*ls<x&&B>1)throw new Error("recovery id is ambiguous for h>1 curve");let T=B===2||B===3?E+c:E;if(!s.isValid(T))throw new Error("recovery id 2 or 3 invalid");let P=s.toBytes(T),Z=t.fromBytes(lt(ds((B&1)===0),P)),D=i.inv(T),N=L(z("msgHash",h)),K=i.create(-N*D),X=i.create(k*D),ft=t.BASE.multiplyUnsafe(K).add(Z.multiplyUnsafe(X));if(ft.is0())throw new Error("point at infinify");return ft.assertValidity(),ft}hasHighS(){return m(this.s)}toBytes(h=b){if(Pr(h),h==="der")return kt(Ct.hexFromSig(this));let x=i.toBytes(this.r),E=i.toBytes(this.s);if(h==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return lt(Uint8Array.of(this.recovery),x,E)}return lt(x,E)}toHex(h){return et(this.toBytes(h))}assertValidity(){}static fromCompact(h){return v.fromBytes(z("sig",h),"compact")}static fromDER(h){return v.fromBytes(z("sig",h),"der")}normalizeS(){return this.hasHighS()?new v(this.r,i.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return et(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return et(this.toBytes("compact"))}}let W=r.bits2int||function(h){if(h.length>8192)throw new Error("input is too large");let x=Rt(h),E=h.length*8-a;return E>0?x>>BigInt(E):x},L=r.bits2int_modN||function(h){return i.create(W(h))},pt=zt(a);function ue(g){return Ko("num < 2^"+a,g,Ht,pt),i.toBytes(g)}function Vt(g,h){return Yt(g,void 0,"message"),h?Yt(e(g),void 0,"prehashed message"):g}function I(g,h,x){if(["recovered","canonical"].some(K=>K in x))throw new Error("sign() legacy options not supported");let{lowS:E,prehash:k,extraEntropy:B}=Ur(x,w);g=Vt(g,k);let A=L(g),T=Ft(i,h),P=[ue(T),ue(A)];if(B!=null&&B!==!1){let K=B===!0?n(p.secretKey):B;P.push(z("extraEntropy",K))}let Z=lt(...P),D=A;function N(K){let X=W(K);if(!i.isValidNot0(X))return;let ft=i.inv(X),q=t.BASE.multiply(X).toAffine(),ot=i.create(q.x);if(ot===Ht)return;let nn=i.create(ft*i.create(D+ot*T));if(nn===Ht)return;let Bo=(q.x===ot?0:2)|Number(q.y&ye),ko=nn;return E&&m(nn)&&(ko=i.neg(nn),Bo^=1),new v(ot,ko,Bo)}return{seed:Z,k2sig:N}}function en(g,h,x={}){g=z("message",g);let{seed:E,k2sig:k}=I(g,h,x);return qo(e.outputLen,i.BYTES,o)(E,k)}function te(g){let h,x=typeof g=="string"||ne(g),E=!x&&g!==null&&typeof g=="object"&&typeof g.r=="bigint"&&typeof g.s=="bigint";if(!x&&!E)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(E)h=new v(g.r,g.s);else if(x){try{h=v.fromBytes(z("sig",g),"der")}catch(k){if(!(k instanceof Ct.Err))throw k}if(!h)try{h=v.fromBytes(z("sig",g),"compact")}catch{return!1}}return h||!1}function C(g,h,x,E={}){let{lowS:k,prehash:B,format:A}=Ur(E,w);if(x=z("publicKey",x),h=Vt(z("message",h),B),"strict"in E)throw new Error("options.strict was renamed to lowS");let T=A===void 0?te(g):v.fromBytes(z("sig",g),A);if(T===!1)return!1;try{let P=t.fromBytes(x);if(k&&T.hasHighS())return!1;let{r:Z,s:D}=T,N=L(h),K=i.inv(D),X=i.create(N*K),ft=i.create(Z*K),q=t.BASE.multiplyUnsafe(X).add(P.multiplyUnsafe(ft));return q.is0()?!1:i.create(q.x)===Z}catch{return!1}}function y(g,h,x={}){let{prehash:E}=Ur(x,w);return h=Vt(h,E),v.fromBytes(g,"recovered").recoverPublicKey(h).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:d,utils:f,lengths:p,Point:t,sign:en,verify:C,recoverPublicKey:y,Signature:v,hash:e})}function ec(t){let e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp,n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(i=>Math.ceil(i/2)))):void 0,o=Gt(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:o,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function nc(t){let{CURVE:e,curveOpts:r}=ec(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function rc(t,e){let r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,mn(r.Fn.ORDER,r.Fn.BITS))})}function hs(t){let{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:o}=nc(t),s=Qi(e,r),i=tc(s,n,o);return rc(t,i)}var fs,Ir,Ct,Ht,ye,ls,Bn,Xi,Nr=Y(()=>{Mo();ht();$e();us();En();fs=(t,e)=>(t+(t>=0?e:-e)/ls)/e;Ir=class extends Error{constructor(e=""){super(e)}},Ct={Err:Ir,_tlv:{encode:(t,e)=>{let{Err:r}=Ct;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");let n=e.length/2,o=Ce(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?Ce(o.length/2|128):"";return Ce(t)+s+o+e},decode(t,e){let{Err:r}=Ct,n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");let o=e[n++],s=!!(o&128),i=0;if(!s)i=o;else{let a=o&127;if(!a)throw new r("tlv.decode(long): indefinite length not supported");if(a>4)throw new r("tlv.decode(long): byte length is too big");let u=e.subarray(n,n+a);if(u.length!==a)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let l of u)i=i<<8|l;if(n+=a,i<128)throw new r("tlv.decode(long): not minimal encoding")}let c=e.subarray(n,n+i);if(c.length!==i)throw new r("tlv.decode: wrong value length");return{v:c,l:e.subarray(n+i)}}},_int:{encode(t){let{Err:e}=Ct;if(t<Ht)throw new e("integer: negative integers are not allowed");let r=Ce(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){let{Err:e}=Ct;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Rt(t)}},toSig(t){let{Err:e,_int:r,_tlv:n}=Ct,o=z("signature",t),{v:s,l:i}=n.decode(48,o);if(i.length)throw new e("invalid signature: left bytes after parsing");let{v:c,l:a}=n.decode(2,s),{v:u,l}=n.decode(2,a);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(c),s:r.decode(u)}},hexFromSig(t){let{_tlv:e,_int:r}=Ct,n=e.encode(2,r.encode(t.r)),o=e.encode(2,r.encode(t.s)),s=n+o;return e.encode(48,s)}},Ht=BigInt(0),ye=BigInt(1),ls=BigInt(2),Bn=BigInt(3),Xi=BigInt(4)});function ws(t,e){let r=n=>hs({...t,hash:n});return{...r(e),create:r}}var gs=Y(()=>{Nr();});function ic(t){let e=be.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),a=BigInt(88),u=t*t*t%e,l=u*u*t%e,d=gt(l,r,e)*l%e,f=gt(d,r,e)*l%e,p=gt(f,Lr,e)*u%e,w=gt(p,o,e)*p%e,b=gt(w,s,e)*w%e,m=gt(b,c,e)*b%e,S=gt(m,a,e)*m%e,U=gt(S,c,e)*b%e,v=gt(U,r,e)*l%e,W=gt(v,i,e)*w%e,L=gt(W,n,e)*u%e,pt=gt(L,Lr,e);if(!kn.eql(kn.sqr(pt),t))throw new Error("Cannot find square root");return pt}function Tn(t,...e){let r=bs[t];if(r===void 0){let n=F(sn(t));r=lt(n,n),bs[t]=r}return F(lt(r,...e))}function Rr(t){let{Fn:e,BASE:r}=me,n=Ft(e,t),o=r.multiply(n);return{scalar:Hr(o.y)?n:e.neg(n),bytes:Cr(o)}}function xs(t){let e=kn;if(!e.isValidNot0(t))throw new Error("invalid x: Fail if x \u2265 p");let r=e.create(t*t),n=e.create(r*t+BigInt(7)),o=e.sqrt(n);Hr(o)||(o=e.neg(o));let s=me.fromAffine({x:t,y:o});return s.assertValidity(),s}function Es(...t){return me.Fn.create(De(Tn("BIP0340/challenge",...t)))}function ms(t){return Rr(t).bytes}function cc(t,e,r=Nt(32)){let{Fn:n}=me,o=z("message",t),{bytes:s,scalar:i}=Rr(e),c=z("auxRand",r,32),a=n.toBytes(i^De(Tn("BIP0340/aux",c))),u=Tn("BIP0340/nonce",a,s,o),{bytes:l,scalar:d}=Rr(u),f=Es(l,s,o),p=new Uint8Array(64);if(p.set(l,0),p.set(n.toBytes(n.create(d+f*i)),32),!Ss(p,o,s))throw new Error("sign: Invalid signature produced");return p}function Ss(t,e,r){let{Fn:n,BASE:o}=me,s=z("signature",t,64),i=z("message",e),c=z("publicKey",r,32);try{let a=xs(De(c)),u=De(s.subarray(0,32));if(!He(u,ys,be.p))return!1;let l=De(s.subarray(32,64));if(!He(l,ys,be.n))return!1;let d=Es(n.toBytes(u),Cr(a),i),f=o.multiplyUnsafe(l).add(a.multiplyUnsafe(n.neg(d))),{x:p,y:w}=f.toAffine();return!(f.is0()||!Hr(w)||p!==u)}catch{return!1}}var be,oc,sc,ys,Lr,kn,jt,bs,Cr,me,Hr,De,Tt,As=Y(()=>{un();ht();gs();En();Nr();$e();be={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},oc={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},sc=BigInt(0),ys=BigInt(1),Lr=BigInt(2);kn=Gt(be.p,{sqrt:ic}),jt=ws({...be,Fp:kn,lowS:!0,endo:oc},F),bs={};Cr=t=>t.toBytes(!0).slice(1),me=jt.Point,Hr=t=>t%Lr===sc;De=Rt;Tt=(()=>{let r=(o=Nt(48))=>xn(o,be.n);jt.utils.randomSecretKey;function n(o){let s=r(o);return{secretKey:s,publicKey:ms(s)}}return{keygen:n,getPublicKey:ms,sign:cc,verify:Ss,Point:me,utils:{randomSecretKey:r,randomPrivateKey:r,taggedHash:Tn,lift_x:xs,pointToBytes:Cr,numberToBytesBE:we,bytesToNumberBE:Rt,mod:wt},lengths:{secretKey:32,publicKey:32,publicKeyHasPrefix:!1,signature:64,seed:48}}})()});function Bs(t,e,r,n){return t===0?e^r^n:t===1?e&r|~e&n:t===2?(e|~r)^n:t===3?e&n|r&~n:e^(r|~n)}var ac,ks,uc,Ts,vs,Us,Ps,fc,lc,dc,pc,vn,_r,Is,Ns=Y(()=>{ir();ht();ac=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),ks=Uint8Array.from(new Array(16).fill(0).map((t,e)=>e)),uc=ks.map(t=>(9*t+5)%16),Ts=(()=>{let r=[[ks],[uc]];for(let n=0;n<4;n++)for(let o of r)o.push(o[n].map(s=>ac[s]));return r})(),vs=Ts[0],Us=Ts[1],Ps=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(t=>Uint8Array.from(t)),fc=vs.map((t,e)=>t.map(r=>Ps[e][r])),lc=Us.map((t,e)=>t.map(r=>Ps[e][r])),dc=Uint32Array.from([0,1518500249,1859775393,2400959708,2840853838]),pc=Uint32Array.from([1352829926,1548603684,1836072691,2053994217,0]);vn=new Uint32Array(16),_r=class extends de{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){let{h0:e,h1:r,h2:n,h3:o,h4:s}=this;return[e,r,n,o,s]}set(e,r,n,o,s){this.h0=e|0,this.h1=r|0,this.h2=n|0,this.h3=o|0,this.h4=s|0}process(e,r){for(let p=0;p<16;p++,r+=4)vn[p]=e.getUint32(r,!0);let n=this.h0|0,o=n,s=this.h1|0,i=s,c=this.h2|0,a=c,u=this.h3|0,l=u,d=this.h4|0,f=d;for(let p=0;p<5;p++){let w=4-p,b=dc[p],m=pc[p],S=vs[p],U=Us[p],v=fc[p],W=lc[p];for(let L=0;L<16;L++){let pt=Ue(n+Bs(p,s,c,u)+vn[S[L]]+b,v[L])+d|0;n=d,d=u,u=Ue(c,10)|0,c=s,s=pt}for(let L=0;L<16;L++){let pt=Ue(o+Bs(w,i,a,l)+vn[U[L]]+m,W[L])+f|0;o=f,f=l,l=Ue(a,10)|0,a=i,i=pt}}this.set(this.h1+c+l|0,this.h2+u+f|0,this.h3+d+o|0,this.h4+n+i|0,this.h0+s+a|0)}roundClean(){Bt(vn)}destroy(){this.destroyed=!0,Bt(this.buffer),this.set(0,0,0,0,0)}},Is=cn(()=>new _r)});function xe(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function mt(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function hc(...t){let e=0;for(let n=0;n<t.length;n++){let o=t[n];if(!mt(o))throw new Error("Uint8Array expected");e+=o.length}let r=new Uint8Array(e);for(let n=0,o=0;n<t.length;n++){let s=t[n];r.set(s,o),o+=s.length}return r}function Ee(t){return Object.prototype.toString.call(t)==="[object Object]"}function vt(t){return Number.isSafeInteger(t)}function Rs(t,e,r){if(r){let n=2n**(e-1n);if(t<-n||t>=n)throw new Error(`value out of signed bounds. Expected ${-n} <= ${t} < ${n}`)}else if(0n>t||t>=2n**e)throw new Error(`value out of unsigned bounds. Expected 0 <= ${t} < ${2n**e}`)}function Cs(t){return{encodeStream:t.encodeStream,decodeStream:t.decodeStream,size:t.size,encode:e=>{let r=new Wr;return t.encodeStream(r,e),r.finish()},decode:(e,r={})=>{let n=new $r(e,r),o=t.decodeStream(n);return n.finish(),o}}}function it(t,e){if(!yt(t))throw new Error(`validate: invalid inner value ${t}`);if(typeof e!="function")throw new Error("validate: fn should be function");return Cs({size:t.size,encodeStream:(r,n)=>{let o;try{o=e(n)}catch(s){throw r.err(s)}t.encodeStream(r,o)},decodeStream:r=>{let n=t.decodeStream(r);try{return e(n)}catch(o){throw r.err(o)}}})}function yt(t){return Ee(t)&&Pn(t)&&typeof t.encodeStream=="function"&&typeof t.decodeStream=="function"&&(t.size===void 0||vt(t.size))}function wc(){return{encode:t=>{if(!Array.isArray(t))throw new Error("array expected");let e={};for(let r of t){if(!Array.isArray(r)||r.length!==2)throw new Error("array of two elements expected");let n=r[0],o=r[1];if(e[n]!==void 0)throw new Error(`key(${n}) appears twice in struct`);e[n]=o}return e},decode:t=>{if(!Ee(t))throw new Error(`expected plain object, got ${t}`);return Object.entries(t)}}}function yc(t){if(!Ee(t))throw new Error("plain object expected");return{encode:e=>{if(!vt(e)||!(e in t))throw new Error(`wrong value ${e}`);return t[e]},decode:e=>{if(typeof e!="string")throw new Error(`wrong value ${typeof e}`);return t[e]}}}function bc(t,e=!1){if(!vt(t))throw new Error(`decimal/precision: wrong value ${t}`);if(typeof e!="boolean")throw new Error(`decimal/round: expected boolean, got ${typeof e}`);let r=10n**BigInt(t);return{encode:n=>{if(typeof n!="bigint")throw new Error(`expected bigint, got ${typeof n}`);let o=(n<0n?-n:n).toString(10),s=o.length-t;s<0&&(o=o.padStart(o.length-s,"0"),s=0);let i=o.length-1;for(;i>=s&&o[i]==="0";i--);let c=o.slice(0,s),a=o.slice(s,i+1);return c||(c="0"),n<0n&&(c="-"+c),a?`${c}.${a}`:c},decode:n=>{if(typeof n!="string")throw new Error(`expected string, got ${typeof n}`);if(n==="-0")throw new Error("negative zero is not allowed");let o=!1;if(n.startsWith("-")&&(o=!0,n=n.slice(1)),!/^(0|[1-9]\d*)(\.\d+)?$/.test(n))throw new Error(`wrong string value=${n}`);let s=n.indexOf(".");s=s===-1?n.length:s;let i=n.slice(0,s),c=n.slice(s+1).replace(/0+$/,""),a=BigInt(i)*r;if(!e&&c.length>t)throw new Error(`fractional part cannot be represented with this precision (num=${n}, prec=${t})`);let u=Math.min(c.length,t),l=BigInt(c.slice(0,u))*10n**BigInt(t-u),d=a+l;return o?-d:d}}}function mc(t){if(!Array.isArray(t))throw new Error(`expected array, got ${typeof t}`);for(let e of t)if(!Pn(e))throw new Error(`wrong base coder ${e}`);return{encode:e=>{for(let r of t){let n=r.encode(e);if(n!==void 0)return n}throw new Error(`match/encode: cannot find match in ${e}`)},decode:e=>{for(let r of t){let n=r.decode(e);if(n!==void 0)return n}throw new Error(`match/decode: cannot find match in ${e}`)}}}function Ds(t,e){if(!yt(e))throw new Error(`prefix: invalid inner value ${e}`);return St(O(t),Hs(e))}function St(t,e){if(!yt(t))throw new Error(`apply: invalid inner value ${t}`);if(!Pn(e))throw new Error(`apply: invalid base value ${t}`);return ct({size:t.size,encodeStream:(r,n)=>{let o;try{o=e.decode(n)}catch(s){throw r.err(""+s)}return t.encodeStream(r,o)},decodeStream:r=>{let n=t.decodeStream(r);try{return e.encode(n)}catch(o){throw r.err(""+o)}}})}function Vs(t,e,r){if(!yt(e))throw new Error(`flagged: invalid inner value ${e}`);if(typeof t!="string"&&!yt(e))throw new Error(`flagged: wrong path=${t}`);return ct({encodeStream:(n,o)=>{typeof t=="string"?_t.resolve(n.stack,t)?e.encodeStream(n,o):r&&e.encodeStream(n,r):(t.encodeStream(n,!!o),o?e.encodeStream(n,o):r&&e.encodeStream(n,r))},decodeStream:n=>{let o=!1;if(typeof t=="string"?o=!!_t.resolve(n.stack,t):o=t.decodeStream(n),o)return e.decodeStream(n);r&&e.decodeStream(n)}})}function Nn(t,e,r=!0){if(!yt(t))throw new Error(`magic: invalid inner value ${t}`);if(typeof r!="boolean")throw new Error(`magic: expected boolean, got ${typeof r}`);return ct({size:t.size,encodeStream:(n,o)=>t.encodeStream(n,e),decodeStream:n=>{let o=t.decodeStream(n);if(r&&typeof o!="object"&&o!==e||mt(e)&&!xe(e,o))throw n.err(`magic: invalid value: ${o} !== ${e}`)},validate:n=>{if(n!==void 0)throw new Error(`magic: wrong value=${typeof n}`);return n}})}function Ks(t){let e=0;for(let r of t){if(r.size===void 0)return;if(!vt(r.size))throw new Error(`sizeof: wrong element size=${e}`);e+=r.size}return e}function Q(t){if(!Ee(t))throw new Error(`struct: expected plain object, got ${t}`);for(let e in t)if(!yt(t[e]))throw new Error(`struct: field ${e} is not CoderType`);return ct({size:Ks(Object.values(t)),encodeStream:(e,r)=>{e.pushObj(r,n=>{for(let o in t)n(o,()=>t[o].encodeStream(e,r[o]))})},decodeStream:e=>{let r={};return e.pushObj(r,n=>{for(let o in t)n(o,()=>r[o]=t[o].decodeStream(e))}),r},validate:e=>{if(typeof e!="object"||e===null)throw new Error(`struct: invalid value ${e}`);return e}})}function qs(t){if(!Array.isArray(t))throw new Error(`Packed.Tuple: got ${typeof t} instead of array`);for(let e=0;e<t.length;e++)if(!yt(t[e]))throw new Error(`tuple: field ${e} is not CoderType`);return ct({size:Ks(t),encodeStream:(e,r)=>{if(!Array.isArray(r))throw e.err(`tuple: invalid value ${r}`);e.pushObj(r,n=>{for(let o=0;o<t.length;o++)n(`${o}`,()=>t[o].encodeStream(e,r[o]))})},decodeStream:e=>{let r=[];return e.pushObj(r,n=>{for(let o=0;o<t.length;o++)n(`${o}`,()=>r.push(t[o].decodeStream(e)))}),r},validate:e=>{if(!Array.isArray(e))throw new Error(`tuple: invalid value ${e}`);if(e.length!==t.length)throw new Error(`tuple: wrong length=${e.length}, expected ${t.length}`);return e}})}function at(t,e){if(!yt(e))throw new Error(`array: invalid inner value ${e}`);let r=Ls(typeof t=="string"?`../${t}`:t);return ct({size:typeof t=="number"&&e.size?t*e.size:void 0,encodeStream:(n,o)=>{let s=n;s.pushObj(o,i=>{mt(t)||r.encodeStream(n,o.length);for(let c=0;c<o.length;c++)i(`${c}`,()=>{let a=o[c],u=n.pos;if(e.encodeStream(n,a),mt(t)){if(t.length>s.pos-u)return;let l=s.finish(!1).subarray(u,s.pos);if(xe(l.subarray(0,t.length),t))throw s.err(`array: inner element encoding same as separator. elm=${a} data=${l}`)}})}),mt(t)&&n.bytes(t)},decodeStream:n=>{let o=[];return n.pushObj(o,s=>{if(t===null)for(let i=0;!n.isEnd()&&(s(`${i}`,()=>o.push(e.decodeStream(n))),!(e.size&&n.leftBytes<e.size));i++);else if(mt(t))for(let i=0;;i++){if(xe(n.bytes(t.length,!0),t)){n.bytes(t.length);break}s(`${i}`,()=>o.push(e.decodeStream(n)))}else{let i;s("arrayLen",()=>i=r.decodeStream(n));for(let c=0;c<i;c++)s(`${c}`,()=>o.push(e.decodeStream(n)))}}),o},validate:n=>{if(!Array.isArray(n))throw new Error(`array: invalid value ${n}`);return n}})}var $,Or,Mr,Un,Ls,tt,_t,$r,Wr,Dr,ct,Pn,gc,Hs,$t,Vr,_s,Se,$s,xc,Oe,R,Ws,Zt,Kr,At,O,In,Os,Ms,Ae=Y(()=>{Le();$=new Uint8Array,Or=new Uint8Array([0]);Mr=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);Un={equalBytes:xe,isBytes:mt,isCoder:yt,checkBounds:Rs,concatBytes:hc,createView:Mr,isPlainObject:Ee},Ls=t=>{if(t!==null&&typeof t!="string"&&!yt(t)&&!mt(t)&&!vt(t))throw new Error(`lengthCoder: expected null | number | Uint8Array | CoderType, got ${t} (${typeof t})`);return{encodeStream(e,r){if(t===null)return;if(yt(t))return t.encodeStream(e,r);let n;if(typeof t=="number"?n=t:typeof t=="string"&&(n=_t.resolve(e.stack,t)),typeof n=="bigint"&&(n=Number(n)),n===void 0||n!==r)throw e.err(`Wrong length: ${n} len=${t} exp=${r} (${typeof r})`)},decodeStream(e){let r;if(yt(t)?r=Number(t.decodeStream(e)):typeof t=="number"?r=t:typeof t=="string"&&(r=_t.resolve(e.stack,t)),typeof r=="bigint"&&(r=Number(r)),typeof r!="number")throw e.err(`Wrong length: ${r}`);return r}}},tt={BITS:32,FULL_MASK:-1>>>0,len:t=>Math.ceil(t/32),create:t=>new Uint32Array(tt.len(t)),clean:t=>t.fill(0),debug:t=>Array.from(t).map(e=>(e>>>0).toString(2).padStart(32,"0")),checkLen:(t,e)=>{if(tt.len(e)!==t.length)throw new Error(`wrong length=${t.length}. Expected: ${tt.len(e)}`)},chunkLen:(t,e,r)=>{if(e<0)throw new Error(`wrong pos=${e}`);if(e+r>t)throw new Error(`wrong range=${e}/${r} of ${t}`)},set:(t,e,r,n=!0)=>!n&&(t[e]&r)!==0?!1:(t[e]|=r,!0),pos:(t,e)=>({chunk:Math.floor((t+e)/32),mask:1<<32-(t+e)%32-1}),indices:(t,e,r=!1)=>{tt.checkLen(t,e);let{FULL_MASK:n,BITS:o}=tt,s=o-e%o,i=s?n>>>s<<s:n,c=[];for(let a=0;a<t.length;a++){let u=t[a];if(r&&(u=~u),a===t.length-1&&(u&=i),u!==0)for(let l=0;l<o;l++){let d=1<<o-l-1;u&d&&c.push(a*o+l)}}return c},range:t=>{let e=[],r;for(let n of t)r===void 0||n!==r.pos+r.length?e.push(r={pos:n,length:1}):r.length+=1;return e},rangeDebug:(t,e,r=!1)=>`[${tt.range(tt.indices(t,e,r)).map(n=>`(${n.pos}/${n.length})`).join(", ")}]`,setRange:(t,e,r,n,o=!0)=>{tt.chunkLen(e,r,n);let{FULL_MASK:s,BITS:i}=tt,c=r%i?Math.floor(r/i):void 0,a=r+n,u=a%i?Math.floor(a/i):void 0;if(c!==void 0&&c===u)return tt.set(t,c,s>>>i-n<<i-n-r,o);if(c!==void 0&&!tt.set(t,c,s>>>r%i,o))return!1;let l=c!==void 0?c+1:r/i,d=u!==void 0?u:a/i;for(let f=l;f<d;f++)if(!tt.set(t,f,s,o))return!1;return!(u!==void 0&&c!==u&&!tt.set(t,u,s<<i-a%i,o))}},_t={pushObj:(t,e,r)=>{let n={obj:e};t.push(n),r((o,s)=>{n.field=o,s(),n.field=void 0}),t.pop()},path:t=>{let e=[];for(let r of t)r.field!==void 0&&e.push(r.field);return e.join("/")},err:(t,e,r)=>{let n=new Error(`${t}(${_t.path(e)}): ${typeof r=="string"?r:r.message}`);return r instanceof Error&&r.stack&&(n.stack=r.stack),n},resolve:(t,e)=>{let r=e.split("/"),n=t.map(i=>i.obj),o=0;for(;o<r.length&&r[o]==="..";o++)n.pop();let s=n.pop();for(;o<r.length;o++){if(!s||s[r[o]]===void 0)return;s=s[r[o]]}return s}},$r=class t{constructor(e,r={},n=[],o=void 0,s=0){this.pos=0,this.bitBuf=0,this.bitPos=0,this.data=e,this.opts=r,this.stack=n,this.parent=o,this.parentOffset=s,this.view=Mr(e)}_enablePointers(){if(this.parent)return this.parent._enablePointers();this.bs||(this.bs=tt.create(this.data.length),tt.setRange(this.bs,this.data.length,0,this.pos,this.opts.allowMultipleReads))}markBytesBS(e,r){return this.parent?this.parent.markBytesBS(this.parentOffset+e,r):!r||!this.bs?!0:tt.setRange(this.bs,this.data.length,e,r,!1)}markBytes(e){let r=this.pos;this.pos+=e;let n=this.markBytesBS(r,e);if(!this.opts.allowMultipleReads&&!n)throw this.err(`multiple read pos=${this.pos} len=${e}`);return n}pushObj(e,r){return _t.pushObj(this.stack,e,r)}readView(e,r){if(!Number.isFinite(e))throw this.err(`readView: wrong length=${e}`);if(this.pos+e>this.data.length)throw this.err("readView: Unexpected end of buffer");let n=r(this.view,this.pos);return this.markBytes(e),n}absBytes(e){if(e>this.data.length)throw new Error("Unexpected end of buffer");return this.data.subarray(e)}finish(){if(!this.opts.allowUnreadBytes){if(this.bitPos)throw this.err(`${this.bitPos} bits left after unpack: ${H.encode(this.data.slice(this.pos))}`);if(this.bs&&!this.parent){let e=tt.indices(this.bs,this.data.length,!0);if(e.length){let r=tt.range(e).map(({pos:n,length:o})=>`(${n}/${o})[${H.encode(this.data.subarray(n,n+o))}]`).join(", ");throw this.err(`unread byte ranges: ${r} (total=${this.data.length})`)}else return}if(!this.isEnd())throw this.err(`${this.leftBytes} bytes ${this.bitPos} bits left after unpack: ${H.encode(this.data.slice(this.pos))}`)}}err(e){return _t.err("Reader",this.stack,e)}offsetReader(e){if(e>this.data.length)throw this.err("offsetReader: Unexpected end of buffer");return new t(this.absBytes(e),this.opts,this.stack,this,e)}bytes(e,r=!1){if(this.bitPos)throw this.err("readBytes: bitPos not empty");if(!Number.isFinite(e))throw this.err(`readBytes: wrong length=${e}`);if(this.pos+e>this.data.length)throw this.err("readBytes: Unexpected end of buffer");let n=this.data.subarray(this.pos,this.pos+e);return r||this.markBytes(e),n}byte(e=!1){if(this.bitPos)throw this.err("readByte: bitPos not empty");if(this.pos+1>this.data.length)throw this.err("readBytes: Unexpected end of buffer");let r=this.data[this.pos];return e||this.markBytes(1),r}get leftBytes(){return this.data.length-this.pos}get totalBytes(){return this.data.length}isEnd(){return this.pos>=this.data.length&&!this.bitPos}bits(e){if(e>32)throw this.err("BitReader: cannot read more than 32 bits in single call");let r=0;for(;e;){this.bitPos||(this.bitBuf=this.byte(),this.bitPos=8);let n=Math.min(e,this.bitPos);this.bitPos-=n,r=r<<n|this.bitBuf>>this.bitPos&2**n-1,this.bitBuf&=2**this.bitPos-1,e-=n}return r>>>0}find(e,r=this.pos){if(!mt(e))throw this.err(`find: needle is not bytes! ${e}`);if(this.bitPos)throw this.err("findByte: bitPos not empty");if(!e.length)throw this.err("find: needle is empty");for(let n=r;(n=this.data.indexOf(e[0],n))!==-1;n++){if(n===-1||this.data.length-n<e.length)return;if(xe(e,this.data.subarray(n,n+e.length)))return n}}},Wr=class{constructor(e=[]){this.pos=0,this.buffers=[],this.ptrs=[],this.bitBuf=0,this.bitPos=0,this.viewBuf=new Uint8Array(8),this.finished=!1,this.stack=e,this.view=Mr(this.viewBuf)}pushObj(e,r){return _t.pushObj(this.stack,e,r)}writeView(e,r){if(this.finished)throw this.err("buffer: finished");if(!vt(e)||e>8)throw new Error(`wrong writeView length=${e}`);r(this.view),this.bytes(this.viewBuf.slice(0,e)),this.viewBuf.fill(0)}err(e){if(this.finished)throw this.err("buffer: finished");return _t.err("Reader",this.stack,e)}bytes(e){if(this.finished)throw this.err("buffer: finished");if(this.bitPos)throw this.err("writeBytes: ends with non-empty bit buffer");this.buffers.push(e),this.pos+=e.length}byte(e){if(this.finished)throw this.err("buffer: finished");if(this.bitPos)throw this.err("writeByte: ends with non-empty bit buffer");this.buffers.push(new Uint8Array([e])),this.pos++}finish(e=!0){if(this.finished)throw this.err("buffer: finished");if(this.bitPos)throw this.err("buffer: ends with non-empty bit buffer");let r=this.buffers.concat(this.ptrs.map(s=>s.buffer)),n=r.map(s=>s.length).reduce((s,i)=>s+i,0),o=new Uint8Array(n);for(let s=0,i=0;s<r.length;s++){let c=r[s];o.set(c,i),i+=c.length}for(let s=this.pos,i=0;i<this.ptrs.length;i++){let c=this.ptrs[i];o.set(c.ptr.encode(s),c.pos),s+=c.buffer.length}if(e){this.buffers=[];for(let s of this.ptrs)s.buffer.fill(0);this.ptrs=[],this.finished=!0,this.bitBuf=0}return o}bits(e,r){if(r>32)throw this.err("writeBits: cannot write more than 32 bits in single call");if(e>=2**r)throw this.err(`writeBits: value (${e}) >= 2**bits (${r})`);for(;r;){let n=Math.min(r,8-this.bitPos);this.bitBuf=this.bitBuf<<n|e>>r-n,this.bitPos+=n,r-=n,e&=2**r-1,this.bitPos===8&&(this.bitPos=0,this.buffers.push(new Uint8Array([this.bitBuf])),this.pos++)}}},Dr=t=>Uint8Array.from(t).reverse();ct=t=>{let e=Cs(t);return t.validate?it(e,t.validate):e},Pn=t=>Ee(t)&&typeof t.decode=="function"&&typeof t.encode=="function";gc={encode:t=>{if(typeof t!="bigint")throw new Error(`expected bigint, got ${typeof t}`);if(t>BigInt(Number.MAX_SAFE_INTEGER))throw new Error(`element bigger than MAX_SAFE_INTEGER=${t}`);return Number(t)},decode:t=>{if(!vt(t))throw new Error("element is not a safe integer");return BigInt(t)}};Hs=t=>{if(!Pn(t))throw new Error("BaseCoder expected");return{encode:t.decode,decode:t.encode}},$t={dict:wc,numberBigint:gc,tsEnum:yc,decimal:bc,match:mc,reverse:Hs},Vr=(t,e=!1,r=!1,n=!0)=>{if(!vt(t))throw new Error(`bigint/size: wrong value ${t}`);if(typeof e!="boolean")throw new Error(`bigint/le: expected boolean, got ${typeof e}`);if(typeof r!="boolean")throw new Error(`bigint/signed: expected boolean, got ${typeof r}`);if(typeof n!="boolean")throw new Error(`bigint/sized: expected boolean, got ${typeof n}`);let o=BigInt(t),s=2n**(8n*o-1n);return ct({size:n?t:void 0,encodeStream:(i,c)=>{r&&c<0&&(c=c|s);let a=[];for(let l=0;l<t;l++)a.push(Number(c&255n)),c>>=8n;let u=new Uint8Array(a).reverse();if(!n){let l=0;for(l=0;l<u.length&&u[l]===0;l++);u=u.subarray(l)}i.bytes(e?u.reverse():u)},decodeStream:i=>{let c=i.bytes(n?t:Math.min(t,i.leftBytes)),a=e?c:Dr(c),u=0n;for(let l=0;l<a.length;l++)u|=BigInt(a[l])<<8n*BigInt(l);return r&&u&s&&(u=(u^s)-s),u},validate:i=>{if(typeof i!="bigint")throw new Error(`bigint: invalid value: ${i}`);return Rs(i,8n*o,!!r),i}})},_s=Vr(32,!1),Se=Vr(8,!0),$s=Vr(8,!0,!0),xc=(t,e)=>ct({size:t,encodeStream:(r,n)=>r.writeView(t,o=>e.write(o,n)),decodeStream:r=>r.readView(t,e.read),validate:r=>{if(typeof r!="number")throw new Error(`viewCoder: expected number, got ${typeof r}`);return e.validate&&e.validate(r),r}}),Oe=(t,e,r)=>{let n=t*8,o=2**(n-1),s=a=>{if(!vt(a))throw new Error(`sintView: value is not safe integer: ${a}`);if(a<-o||a>=o)throw new Error(`sintView: value out of bounds. Expected ${-o} <= ${a} < ${o}`)},i=2**n,c=a=>{if(!vt(a))throw new Error(`uintView: value is not safe integer: ${a}`);if(0>a||a>=i)throw new Error(`uintView: value out of bounds. Expected 0 <= ${a} < ${i}`)};return xc(t,{write:r.write,read:r.read,validate:e?s:c})},R=Oe(4,!1,{read:(t,e)=>t.getUint32(e,!0),write:(t,e)=>t.setUint32(0,e,!0)}),Ws=Oe(4,!1,{read:(t,e)=>t.getUint32(e,!1),write:(t,e)=>t.setUint32(0,e,!1)}),Zt=Oe(4,!0,{read:(t,e)=>t.getInt32(e,!0),write:(t,e)=>t.setInt32(0,e,!0)}),Kr=Oe(2,!1,{read:(t,e)=>t.getUint16(e,!0),write:(t,e)=>t.setUint16(0,e,!0)}),At=Oe(1,!1,{read:(t,e)=>t.getUint8(e),write:(t,e)=>t.setUint8(0,e)}),O=(t,e=!1)=>{if(typeof e!="boolean")throw new Error(`bytes/le: expected boolean, got ${typeof e}`);let r=Ls(t),n=mt(t);return ct({size:typeof t=="number"?t:void 0,encodeStream:(o,s)=>{n||r.encodeStream(o,s.length),o.bytes(e?Dr(s):s),n&&o.bytes(t)},decodeStream:o=>{let s;if(n){let i=o.find(t);if(!i)throw o.err("bytes: cannot find terminator");s=o.bytes(i-o.pos),o.bytes(t.length)}else s=o.bytes(t===null?o.leftBytes:r.decodeStream(o));return e?Dr(s):s},validate:o=>{if(!mt(o))throw new Error(`bytes: invalid value ${o}`);return o}})};In=(t,e=!1)=>it(St(O(t,e),Oo),r=>{if(typeof r!="string")throw new Error(`expected string, got ${typeof r}`);return r}),Os=(t,e={isLE:!1,with0x:!1})=>{let r=St(O(t,e.isLE),H),n=e.with0x;if(typeof n!="boolean")throw new Error(`hex/with0x: expected boolean, got ${typeof n}`);return n&&(r=St(r,{encode:o=>`0x${o}`,decode:o=>{if(!o.startsWith("0x"))throw new Error("hex(with0x=true).encode input should start with 0x");return o.slice(2)}})),r};Ms=(t,e=!1)=>{if(!mt(t))throw new Error(`flag/flagValue: expected Uint8Array, got ${typeof t}`);if(typeof e!="boolean")throw new Error(`flag/xor: expected boolean, got ${typeof e}`);return ct({size:t.length,encodeStream:(r,n)=>{!!n!==e&&r.bytes(t)},decodeStream:r=>{let n=r.leftBytes>=t.length;return n&&(n=xe(r.bytes(t.length,!0),t),n&&r.bytes(t.length)),n!==e},validate:r=>{if(r!==void 0&&typeof r!="boolean")throw new Error(`flag: expected boolean value or undefined, got ${typeof r}`);return r}})}});function zs(t,e,r=!1){let n=jt.sign(t,e);if(r&&!Ys(n)){let o=new Uint8Array(32),s=0;for(;!Ys(n);)if(o.set(R.encode(s++)),n=jt.sign(t,e,{extraEntropy:o}),s>4294967295)throw new Error("lowR counter overflow: report the error")}return n.toDERRawBytes()}function Xt(t,e){let r=t.length;if(e===nt.ecdsa){if(r===32)throw new Error("Expected non-Schnorr key");return Cn.fromHex(t),t}else if(e===nt.schnorr){if(r!==32)throw new Error("Expected 32-byte Schnorr key");return Tt.utils.lift_x(Tt.utils.bytesToNumberBE(t)),t}else throw new Error("Unknown key type")}function Gs(t,e){let r=Tt.utils,n=r.taggedHash("TapTweak",t,e),o=r.bytesToNumberBE(n);if(o>=Rn)throw new Error("tweak higher than curve order");return o}function Fs(t,e=Uint8Array.of()){let r=Tt.utils,n=r.bytesToNumberBE(t),o=Cn.fromPrivateKey(n),s=o.hasEvenY()?n:r.mod(-n,Rn),i=r.pointToBytes(o),c=Gs(i,e);return r.numberToBytesBE(r.mod(s+c,Rn),32)}function Ve(t,e){let r=Tt.utils,n=Gs(t,e),s=r.lift_x(r.bytesToNumberBE(t)).add(Cn.fromPrivateKey(n)),i=s.hasEvenY()?0:1;return[r.pointToBytes(s),i]}function Ke(t,e){if(!_(t)||!_(e))throw new Error(`cmp: wrong type a=${typeof t} b=${typeof e}`);let r=Math.min(t.length,e.length);for(let n=0;n<r;n++)if(t[n]!=e[n])return Math.sign(t[n]-e[n]);return Math.sign(t.length-e.length)}var Cn,Rn,_,Ut,G,Hn,Wt,gu,_n,qr,Ys,Yr,Me,nt,$n,Pt,Wn,Qt=Y(()=>{As();Ns();un();Ae();Cn=jt.ProjectivePoint,Rn=jt.CURVE.n,_=Un.isBytes,Ut=Un.concatBytes,G=Un.equalBytes,Hn=t=>Is(F(t)),Wt=(...t)=>F(F(Ut(...t))),gu=Tt.utils.randomPrivateKey,_n=Tt.getPublicKey,qr=jt.getPublicKey,Ys=t=>t.r<Rn/2n;Yr=Tt.sign,Me=Tt.utils.taggedHash;(function(t){t[t.ecdsa=0]="ecdsa",t[t.schnorr=1]="schnorr"})(nt||(nt={}));$n=F(Cn.BASE.toRawBytes(!1)),Pt={bech32:"bc",pubKeyHash:0,scriptHash:5,wif:128},Wn={bech32:"tb",pubKeyHash:111,scriptHash:196,wif:239}});function zr(t=6,e=!1){return ct({encodeStream:(r,n)=>{if(n===0n)return;let o=n<0,s=BigInt(n),i=[];for(let c=o?-s:s;c;c>>=8n)i.push(Number(c&0xffn));i[i.length-1]>=128?i.push(o?128:0):o&&(i[i.length-1]|=128),r.bytes(new Uint8Array(i))},decodeStream:r=>{let n=r.leftBytes;if(n>t)throw new Error(`ScriptNum: number (${n}) bigger than limit=${t}`);if(n===0)return 0n;if(e){let i=r.bytes(n,!0);if((i[i.length-1]&127)===0&&(n<=1||(i[i.length-2]&128)===0))throw new Error("Non-minimally encoded ScriptNum")}let o=0,s=0n;for(let i=0;i<n;++i)o=r.byte(),s|=BigInt(o)<<8n*BigInt(i);return o>=128&&(s&=2n**BigInt(n*8)-1n>>1n,s=-s),s}})}function Xs(t,e=4,r=!0){if(typeof t=="number")return t;if(_(t))try{let n=zr(e,r).decode(t);return n>Number.MAX_SAFE_INTEGER?void 0:Number(n)}catch{return}}function Sc(t){if(t.segwitFlag&&t.witnesses&&!t.witnesses.length)throw new Error("Segwit flag with empty witnesses array");return t}var j,M,Zs,Be,bt,dt,ke,Dn,Qs,Dt,Ec,Ot,se,qe=Y(()=>{Ae();Qt();(function(t){t[t.OP_0=0]="OP_0",t[t.PUSHDATA1=76]="PUSHDATA1",t[t.PUSHDATA2=77]="PUSHDATA2",t[t.PUSHDATA4=78]="PUSHDATA4",t[t["1NEGATE"]=79]="1NEGATE",t[t.RESERVED=80]="RESERVED",t[t.OP_1=81]="OP_1",t[t.OP_2=82]="OP_2",t[t.OP_3=83]="OP_3",t[t.OP_4=84]="OP_4",t[t.OP_5=85]="OP_5",t[t.OP_6=86]="OP_6",t[t.OP_7=87]="OP_7",t[t.OP_8=88]="OP_8",t[t.OP_9=89]="OP_9",t[t.OP_10=90]="OP_10",t[t.OP_11=91]="OP_11",t[t.OP_12=92]="OP_12",t[t.OP_13=93]="OP_13",t[t.OP_14=94]="OP_14",t[t.OP_15=95]="OP_15",t[t.OP_16=96]="OP_16",t[t.NOP=97]="NOP",t[t.VER=98]="VER",t[t.IF=99]="IF",t[t.NOTIF=100]="NOTIF",t[t.VERIF=101]="VERIF",t[t.VERNOTIF=102]="VERNOTIF",t[t.ELSE=103]="ELSE",t[t.ENDIF=104]="ENDIF",t[t.VERIFY=105]="VERIFY",t[t.RETURN=106]="RETURN",t[t.TOALTSTACK=107]="TOALTSTACK",t[t.FROMALTSTACK=108]="FROMALTSTACK",t[t["2DROP"]=109]="2DROP",t[t["2DUP"]=110]="2DUP",t[t["3DUP"]=111]="3DUP",t[t["2OVER"]=112]="2OVER",t[t["2ROT"]=113]="2ROT",t[t["2SWAP"]=114]="2SWAP",t[t.IFDUP=115]="IFDUP",t[t.DEPTH=116]="DEPTH",t[t.DROP=117]="DROP",t[t.DUP=118]="DUP",t[t.NIP=119]="NIP",t[t.OVER=120]="OVER",t[t.PICK=121]="PICK",t[t.ROLL=122]="ROLL",t[t.ROT=123]="ROT",t[t.SWAP=124]="SWAP",t[t.TUCK=125]="TUCK",t[t.CAT=126]="CAT",t[t.SUBSTR=127]="SUBSTR",t[t.LEFT=128]="LEFT",t[t.RIGHT=129]="RIGHT",t[t.SIZE=130]="SIZE",t[t.INVERT=131]="INVERT",t[t.AND=132]="AND",t[t.OR=133]="OR",t[t.XOR=134]="XOR",t[t.EQUAL=135]="EQUAL",t[t.EQUALVERIFY=136]="EQUALVERIFY",t[t.RESERVED1=137]="RESERVED1",t[t.RESERVED2=138]="RESERVED2",t[t["1ADD"]=139]="1ADD",t[t["1SUB"]=140]="1SUB",t[t["2MUL"]=141]="2MUL",t[t["2DIV"]=142]="2DIV",t[t.NEGATE=143]="NEGATE",t[t.ABS=144]="ABS",t[t.NOT=145]="NOT",t[t["0NOTEQUAL"]=146]="0NOTEQUAL",t[t.ADD=147]="ADD",t[t.SUB=148]="SUB",t[t.MUL=149]="MUL",t[t.DIV=150]="DIV",t[t.MOD=151]="MOD",t[t.LSHIFT=152]="LSHIFT",t[t.RSHIFT=153]="RSHIFT",t[t.BOOLAND=154]="BOOLAND",t[t.BOOLOR=155]="BOOLOR",t[t.NUMEQUAL=156]="NUMEQUAL",t[t.NUMEQUALVERIFY=157]="NUMEQUALVERIFY",t[t.NUMNOTEQUAL=158]="NUMNOTEQUAL",t[t.LESSTHAN=159]="LESSTHAN",t[t.GREATERTHAN=160]="GREATERTHAN",t[t.LESSTHANOREQUAL=161]="LESSTHANOREQUAL",t[t.GREATERTHANOREQUAL=162]="GREATERTHANOREQUAL",t[t.MIN=163]="MIN",t[t.MAX=164]="MAX",t[t.WITHIN=165]="WITHIN",t[t.RIPEMD160=166]="RIPEMD160",t[t.SHA1=167]="SHA1",t[t.SHA256=168]="SHA256",t[t.HASH160=169]="HASH160",t[t.HASH256=170]="HASH256",t[t.CODESEPARATOR=171]="CODESEPARATOR",t[t.CHECKSIG=172]="CHECKSIG",t[t.CHECKSIGVERIFY=173]="CHECKSIGVERIFY",t[t.CHECKMULTISIG=174]="CHECKMULTISIG",t[t.CHECKMULTISIGVERIFY=175]="CHECKMULTISIGVERIFY",t[t.NOP1=176]="NOP1",t[t.CHECKLOCKTIMEVERIFY=177]="CHECKLOCKTIMEVERIFY",t[t.CHECKSEQUENCEVERIFY=178]="CHECKSEQUENCEVERIFY",t[t.NOP4=179]="NOP4",t[t.NOP5=180]="NOP5",t[t.NOP6=181]="NOP6",t[t.NOP7=182]="NOP7",t[t.NOP8=183]="NOP8",t[t.NOP9=184]="NOP9",t[t.NOP10=185]="NOP10",t[t.CHECKSIGADD=186]="CHECKSIGADD",t[t.INVALID=255]="INVALID"})(j||(j={}));M=ct({encodeStream:(t,e)=>{for(let r of e){if(typeof r=="string"){if(j[r]===void 0)throw new Error(`Unknown opcode=${r}`);t.byte(j[r]);continue}else if(typeof r=="number"){if(r===0){t.byte(0);continue}else if(1<=r&&r<=16){t.byte(j.OP_1-1+r);continue}}if(typeof r=="number"&&(r=zr().encode(BigInt(r))),!_(r))throw new Error(`Wrong Script OP=${r} (${typeof r})`);let n=r.length;n<j.PUSHDATA1?t.byte(n):n<=255?(t.byte(j.PUSHDATA1),t.byte(n)):n<=65535?(t.byte(j.PUSHDATA2),t.bytes(Kr.encode(n))):(t.byte(j.PUSHDATA4),t.bytes(R.encode(n))),t.bytes(r)}},decodeStream:t=>{let e=[];for(;!t.isEnd();){let r=t.byte();if(j.OP_0<r&&r<=j.PUSHDATA4){let n;if(r<j.PUSHDATA1)n=r;else if(r===j.PUSHDATA1)n=At.decodeStream(t);else if(r===j.PUSHDATA2)n=Kr.decodeStream(t);else if(r===j.PUSHDATA4)n=R.decodeStream(t);else throw new Error("Should be not possible");e.push(t.bytes(n))}else if(r===0)e.push(0);else if(j.OP_1<=r&&r<=j.OP_16)e.push(r-(j.OP_1-1));else{let n=j[r];if(n===void 0)throw new Error(`Unknown opcode=${r.toString(16)}`);e.push(n)}}return e}}),Zs={253:[253,2,253n,65535n],254:[254,4,65536n,4294967295n],255:[255,8,4294967296n,18446744073709551615n]},Be=ct({encodeStream:(t,e)=>{if(typeof e=="number"&&(e=BigInt(e)),0n<=e&&e<=252n)return t.byte(Number(e));for(let[r,n,o,s]of Object.values(Zs))if(!(o>e||e>s)){t.byte(r);for(let i=0;i<n;i++)t.byte(Number(e>>8n*BigInt(i)&0xffn));return}throw t.err(`VarInt too big: ${e}`)},decodeStream:t=>{let e=t.byte();if(e<=252)return BigInt(e);let[r,n,o]=Zs[e],s=0n;for(let i=0;i<n;i++)s|=BigInt(t.byte())<<8n*BigInt(i);if(s<o)throw t.err(`Wrong CompactSize(${8*n})`);return s}}),bt=St(Be,$t.numberBigint),dt=O(Be),ke=at(bt,dt),Dn=t=>at(Be,t),Qs=Q({txid:O(32,!0),index:R,finalScriptSig:dt,sequence:R}),Dt=Q({amount:Se,script:dt}),Ec=Q({version:Zt,segwitFlag:Ms(new Uint8Array([0,1])),inputs:Dn(Qs),outputs:Dn(Dt),witnesses:Vs("segwitFlag",at("inputs/length",ke)),lockTime:R});Ot=it(Ec,Sc),se=Q({version:Zt,inputs:Dn(Qs),outputs:Dn(Dt),lockTime:R})});function jr(t){let[e,r,n,o,s,i]=t;return{type:e,kc:r,vc:n,reqInc:o,allowInc:s,silentIgnore:i}}function Zr(t){let e={};for(let r in t){let[n,o,s]=t[r];e[n]=[r,o,s]}return ct({encodeStream:(r,n)=>{let o=[];for(let s in t){let i=n[s];if(i===void 0)continue;let[c,a,u]=t[s];if(!a)o.push({key:{type:c,key:$},value:u.encode(i)});else{let l=i.map(([d,f])=>[a.encode(d),u.encode(f)]);l.sort((d,f)=>Ke(d[0],f[0]));for(let[d,f]of l)o.push({key:{key:d,type:c},value:f})}}if(n.unknown){n.unknown.sort((s,i)=>Ke(s[0].key,i[0].key));for(let[s,i]of n.unknown)o.push({key:s,value:i})}ei.encodeStream(r,o)},decodeStream:r=>{let n=ei.decodeStream(r),o={},s={};for(let i of n){let c="unknown",a=i.key.key,u=i.value;if(e[i.key.type]){let[l,d,f]=e[i.key.type];if(c=l,!d&&a.length)throw new Error(`PSBT: Non-empty key for ${c} (key=${H.encode(a)} value=${H.encode(u)}`);if(a=d?d.decode(a):void 0,u=f.decode(u),!d){if(o[c])throw new Error(`PSBT: Same keys: ${c} (key=${a} value=${u})`);o[c]=u,s[c]=!0;continue}}else a={type:i.key.type,key:i.key.key};if(s[c])throw new Error(`PSBT: Key type with empty key and no key=${c} val=${u}`);o[c]||(o[c]=[]),o[c].push([a,u])}return o}})}function Gr(t,e,r){for(let n in r){if(n==="unknown"||!e[n])continue;let{allowInc:o}=jr(e[n]);if(!o.includes(t))throw new Error(`PSBTv${t}: field ${n} is not allowed`)}for(let n in e){let{reqInc:o}=jr(e[n]);if(o.includes(t)&&r[n]===void 0)throw new Error(`PSBTv${t}: missing required field ${n}`)}}function Xr(t,e,r){let n={};for(let o in r){let s=o;if(s!=="unknown"){if(!e[s])continue;let{allowInc:i,silentIgnore:c}=jr(e[s]);if(!i.includes(t)){if(c)continue;throw new Error(`Failed to serialize in PSBTv${t}: ${s} but versions allows inclusion=${i}`)}}n[s]=r[s]}return n}function ci(t){let e=t&&t.global&&t.global.version||0;Gr(e,Vn,t.global);for(let i of t.inputs)Gr(e,ze,i);for(let i of t.outputs)Gr(e,Ge,i);let r=e?t.global.inputCount:t.global.unsignedTx.inputs.length;if(t.inputs.length<r)throw new Error("Not enough inputs");let n=t.inputs.slice(r);if(n.length>1||n.length&&Object.keys(n[0]).length)throw new Error(`Unexpected inputs left in tx=${n}`);let o=e?t.global.outputCount:t.global.unsignedTx.outputs.length;if(t.outputs.length<o)throw new Error("Not outputs inputs");let s=t.outputs.slice(o);if(s.length>1||s.length&&Object.keys(s[0]).length)throw new Error(`Unexpected outputs left in tx=${s}`);return t}function Yn(t,e,r,n,o){let s={...r,...e};for(let i in t){let c=i,[a,u,l]=t[c],d=n&&!n.includes(i);if(e[i]===void 0&&i in e){if(d)throw new Error(`Cannot remove signed field=${i}`);delete s[i]}else if(u){let f=r&&r[i]?r[i]:[],p=e[c];if(p){if(!Array.isArray(p))throw new Error(`keyMap(${i}): KV pairs should be [k, v][]`);p=p.map(m=>{if(m.length!==2)throw new Error(`keyMap(${i}): KV pairs should be [k, v][]`);return[typeof m[0]=="string"?u.decode(H.decode(m[0])):m[0],typeof m[1]=="string"?l.decode(H.decode(m[1])):m[1]]});let w={},b=(m,S,U)=>{if(w[m]===void 0){w[m]=[S,U];return}let v=H.encode(l.encode(w[m][1])),W=H.encode(l.encode(U));if(v!==W)throw new Error(`keyMap(${c}): same key=${m} oldVal=${v} newVal=${W}`)};for(let[m,S]of f){let U=H.encode(u.encode(m));b(U,m,S)}for(let[m,S]of p){let U=H.encode(u.encode(m));if(S===void 0){if(d)throw new Error(`Cannot remove signed field=${c}/${m}`);delete w[U]}else b(U,m,S)}s[c]=Object.values(w)}}else if(typeof s[i]=="string")s[i]=l.decode(H.decode(s[i]));else if(d&&i in e&&r&&r[i]!==void 0&&!G(l.encode(e[i]),l.encode(r[i])))throw new Error(`Cannot change signed field=${i}`)}for(let i in s)if(!t[i]){if(o&&i==="unknown")continue;delete s[i]}return s}var Fr,On,Js,Mn,ni,Ac,Bc,kc,Mt,Tc,J,ti,Ye,Vn,ze,ri,oi,Ge,si,ei,Su,Kn,qn,ii,vc,Uc,Au,Qr,Jr,to=Y(()=>{Le();Ae();qe();Qt();Fr=it(O(null),t=>Xt(t,nt.ecdsa)),On=it(O(32),t=>Xt(t,nt.schnorr)),Js=it(O(null),t=>{if(t.length!==64&&t.length!==65)throw new Error("Schnorr signature should be 64 or 65 bytes long");return t}),Mn=Q({fingerprint:Ws,path:at(null,R)}),ni=Q({hashes:at(bt,O(32)),der:Mn}),Ac=O(78),Bc=Q({pubKey:On,leafHash:O(32)}),kc=Q({version:At,internalKey:O(32),merklePath:at(null,O(32))}),Mt=it(kc,t=>{if(t.merklePath.length>128)throw new Error("TaprootControlBlock: merklePath should be of length 0..128 (inclusive)");return t}),Tc=at(null,Q({depth:At,version:At,script:dt})),J=O(null),ti=O(20),Ye=O(32),Vn={unsignedTx:[0,!1,se,[0],[0],!1],xpub:[1,Ac,Mn,[],[0,2],!1],txVersion:[2,!1,R,[2],[2],!1],fallbackLocktime:[3,!1,R,[],[2],!1],inputCount:[4,!1,bt,[2],[2],!1],outputCount:[5,!1,bt,[2],[2],!1],txModifiable:[6,!1,At,[],[2],!1],version:[251,!1,R,[],[0,2],!1],proprietary:[252,J,J,[],[0,2],!1]},ze={nonWitnessUtxo:[0,!1,Ot,[],[0,2],!1],witnessUtxo:[1,!1,Dt,[],[0,2],!1],partialSig:[2,Fr,J,[],[0,2],!1],sighashType:[3,!1,R,[],[0,2],!1],redeemScript:[4,!1,J,[],[0,2],!1],witnessScript:[5,!1,J,[],[0,2],!1],bip32Derivation:[6,Fr,Mn,[],[0,2],!1],finalScriptSig:[7,!1,J,[],[0,2],!1],finalScriptWitness:[8,!1,ke,[],[0,2],!1],porCommitment:[9,!1,J,[],[0,2],!1],ripemd160:[10,ti,J,[],[0,2],!1],sha256:[11,Ye,J,[],[0,2],!1],hash160:[12,ti,J,[],[0,2],!1],hash256:[13,Ye,J,[],[0,2],!1],txid:[14,!1,Ye,[2],[2],!0],index:[15,!1,R,[2],[2],!0],sequence:[16,!1,R,[],[2],!0],requiredTimeLocktime:[17,!1,R,[],[2],!1],requiredHeightLocktime:[18,!1,R,[],[2],!1],tapKeySig:[19,!1,Js,[],[0,2],!1],tapScriptSig:[20,Bc,Js,[],[0,2],!1],tapLeafScript:[21,Mt,J,[],[0,2],!1],tapBip32Derivation:[22,Ye,ni,[],[0,2],!1],tapInternalKey:[23,!1,On,[],[0,2],!1],tapMerkleRoot:[24,!1,Ye,[],[0,2],!1],proprietary:[252,J,J,[],[0,2],!1]},ri=["txid","sequence","index","witnessUtxo","nonWitnessUtxo","finalScriptSig","finalScriptWitness","unknown"],oi=["partialSig","finalScriptSig","finalScriptWitness","tapKeySig","tapScriptSig"],Ge={redeemScript:[0,!1,J,[],[0,2],!1],witnessScript:[1,!1,J,[],[0,2],!1],bip32Derivation:[2,Fr,Mn,[],[0,2],!1],amount:[3,!1,$s,[2],[2],!0],script:[4,!1,J,[2],[2],!0],tapInternalKey:[5,!1,On,[],[0,2],!1],tapTree:[6,!1,Tc,[],[0,2],!1],tapBip32Derivation:[7,On,ni,[],[0,2],!1],proprietary:[252,J,J,[],[0,2],!1]},si=[],ei=at(Or,Q({key:Ds(bt,Q({type:bt,key:O(null)})),value:O(bt)}));Su=Q({type:bt,key:O(null)});Kn=it(Zr(ze),t=>{if(t.finalScriptWitness&&!t.finalScriptWitness.length)throw new Error("validateInput: empty finalScriptWitness");if(t.partialSig&&!t.partialSig.length)throw new Error("Empty partialSig");if(t.partialSig)for(let[e]of t.partialSig)Xt(e,nt.ecdsa);if(t.bip32Derivation)for(let[e]of t.bip32Derivation)Xt(e,nt.ecdsa);if(t.requiredTimeLocktime!==void 0&&t.requiredTimeLocktime<5e8)throw new Error(`validateInput: wrong timeLocktime=${t.requiredTimeLocktime}`);if(t.requiredHeightLocktime!==void 0&&(t.requiredHeightLocktime<=0||t.requiredHeightLocktime>=5e8))throw new Error(`validateInput: wrong heighLocktime=${t.requiredHeightLocktime}`);if(t.tapLeafScript)for(let[e,r]of t.tapLeafScript){if((e.version&254)!==r[r.length-1])throw new Error("validateInput: tapLeafScript version mimatch");if(r[r.length-1]&1)throw new Error("validateInput: tapLeafScript version has parity bit!")}return t}),qn=it(Zr(Ge),t=>{if(t.bip32Derivation)for(let[e]of t.bip32Derivation)Xt(e,nt.ecdsa);return t}),ii=it(Zr(Vn),t=>{if((t.version||0)===0){if(!t.unsignedTx)throw new Error("PSBTv0: missing unsignedTx");for(let r of t.unsignedTx.inputs)if(r.finalScriptSig&&r.finalScriptSig.length)throw new Error("PSBTv0: input scriptSig found in unsignedTx")}return t}),vc=Q({magic:Nn(In(new Uint8Array([255])),"psbt"),global:ii,inputs:at("global/unsignedTx/inputs/length",Kn),outputs:at(null,qn)}),Uc=Q({magic:Nn(In(new Uint8Array([255])),"psbt"),global:ii,inputs:at("global/inputCount",Kn),outputs:at("global/outputCount",qn)}),Au=Q({magic:Nn(In(new Uint8Array([255])),"psbt"),items:at(null,St(at(Or,qs([Os(bt),O(Be)])),$t.dict()))});Qr=it(vc,ci),Jr=it(Uc,ci)});function Te(t,e){try{return Xt(t,e),!0}catch{return!1}}function ai(t,e){if(!G(t.hash,F(e)))throw new Error("checkScript: wsh wrong witnessScript hash");let r=rt.decode(e);if(r.type==="tr"||r.type==="tr_ns"||r.type==="tr_ms")throw new Error(`checkScript: P2${r.type} cannot be wrapped in P2SH`);if(r.type==="wpkh"||r.type==="sh")throw new Error(`checkScript: P2${r.type} cannot be wrapped in P2WSH`)}function io(t,e,r){if(t){let n=rt.decode(t);if(n.type==="tr_ns"||n.type==="tr_ms"||n.type==="ms"||n.type=="pk")throw new Error(`checkScript: non-wrapped ${n.type}`);if(n.type==="sh"&&e){if(!G(n.hash,Hn(e)))throw new Error("checkScript: sh wrong redeemScript hash");let o=rt.decode(e);if(o.type==="tr"||o.type==="tr_ns"||o.type==="tr_ms")throw new Error(`checkScript: P2${o.type} cannot be wrapped in P2SH`);if(o.type==="sh")throw new Error("checkScript: P2SH cannot be wrapped in P2SH")}n.type==="wsh"&&r&&ai(n,r)}if(e){let n=rt.decode(e);n.type==="wsh"&&r&&ai(n,r)}}function Kc(t,e,r=!1,n){let o=rt.decode(t);if(o.type==="unknown"){if(n){let c=St(M,$t.match(n)).decode(t);if(c!==void 0){if(typeof c.type!="string"||!c.type.startsWith("tr_"))throw new Error(`P2TR: invalid custom type=${c.type}`);return}}if(r)return}if(!["tr_ns","tr_ms"].includes(o.type))throw new Error(`P2TR: invalid leaf script=${o.type}`);let s=o;if(!r&&s.pubkeys)for(let i of s.pubkeys){if(G(i,$n))throw new Error("Unspendable taproot key in leaf script");if(G(i,e))throw new Error("Using P2TR with leaf script with same key as internal key is not supported")}}function qc(t){let e=Array.from(t);for(;e.length>=2;){e.sort((i,c)=>(c.weight||1)-(i.weight||1));let n=e.pop(),o=e.pop(),s=(o?.weight||1)+(n?.weight||1);e.push({weight:s,childs:[o?.childs||o,n?.childs||n]})}let r=e[0];return r?.childs||r}function no(t,e=[]){if(!t)throw new Error("taprootAddPath: empty tree");if(t.type==="leaf")return{...t,path:e};if(t.type!=="branch")throw new Error(`taprootAddPath: wrong type=${t}`);return{...t,path:e,left:no(t.left,[t.right.hash,...e]),right:no(t.right,[t.left.hash,...e])}}function ro(t){if(!t)throw new Error("taprootAddPath: empty tree");if(t.type==="leaf")return[t];if(t.type!=="branch")throw new Error(`taprootWalkTree: wrong type=${t}`);return[...ro(t.left),...ro(t.right)]}function oo(t,e,r=!1,n){if(!t)throw new Error("taprootHashTree: empty tree");if(Array.isArray(t)&&t.length===1&&(t=t[0]),!Array.isArray(t)){let{leafVersion:a,script:u}=t;if(t.tapLeafScript||t.tapMerkleRoot&&!G(t.tapMerkleRoot,$))throw new Error("P2TR: tapRoot leafScript cannot have tree");let l=typeof u=="string"?H.decode(u):u;if(!_(l))throw new Error(`checkScript: wrong script type=${l}`);return Kc(l,e,r,n),{type:"leaf",version:a,script:l,hash:je(l,a)}}if(t.length!==2&&(t=qc(t)),t.length!==2)throw new Error("hashTree: non binary tree!");let o=oo(t[0],e,r,n),s=oo(t[1],e,r,n),[i,c]=[o.hash,s.hash];return Ke(c,i)===-1&&([i,c]=[c,i]),{type:"branch",left:o,right:s,hash:Me("TapBranch",i,c)}}function co(t,e,r=Pt,n=!1,o){if(!t&&!e)throw new Error("p2tr: should have pubKey or scriptTree (or both)");let s=typeof t=="string"?H.decode(t):t||$n;if(!Te(s,nt.schnorr))throw new Error("p2tr: non-schnorr pubkey");if(e){let i=no(oo(e,s,n,o)),c=i.hash,[a,u]=Ve(s,c),l=ro(i).map(d=>({...d,controlBlock:Mt.encode({version:(d.version||so)+u,internalKey:s,merklePath:d.path})}));return{type:"tr",script:rt.encode({type:"tr",pubkey:a}),address:Fe(r).encode({type:"tr",pubkey:a}),tweakedPubkey:a,tapInternalKey:s,leaves:l,tapLeafScript:l.map(d=>[Mt.decode(d.controlBlock),Ut(d.script,new Uint8Array([d.version||so]))]),tapMerkleRoot:c}}else{let i=Ve(s,$)[0];return{type:"tr",script:rt.encode({type:"tr",pubkey:i}),address:Fe(r).encode({type:"tr",pubkey:i}),tweakedPubkey:i,tapInternalKey:s}}}function li(t,e){if(e.length<2||e.length>40)throw new Error("Witness: invalid length");if(t>16)throw new Error("Witness: invalid version");if(t===0&&!(e.length===20||e.length===32))throw new Error("Witness: invalid length for version")}function eo(t,e,r=Pt){li(t,e);let n=t===0?wn:hr;return n.encode(r.bech32,[t].concat(n.toWords(e)))}function ui(t,e){return fi.encode(Ut(Uint8Array.from(e),t))}function Fe(t=Pt){return{encode(e){let{type:r}=e;if(r==="wpkh")return eo(0,e.hash,t);if(r==="wsh")return eo(0,e.hash,t);if(r==="tr")return eo(1,e.pubkey,t);if(r==="pkh")return ui(e.hash,[t.pubKeyHash]);if(r==="sh")return ui(e.hash,[t.scriptHash]);throw new Error(`Unknown address type=${r}`)},decode(e){if(e.length<14||e.length>74)throw new Error("Invalid address length");if(t.bech32&&e.toLowerCase().startsWith(`${t.bech32}1`)){let n;try{if(n=wn.decode(e),n.words[0]!==0)throw new Error(`bech32: wrong version=${n.words[0]}`)}catch{if(n=hr.decode(e),n.words[0]===0)throw new Error(`bech32m: wrong version=${n.words[0]}`)}if(n.prefix!==t.bech32)throw new Error(`wrong bech32 prefix=${n.prefix}`);let[o,...s]=n.words,i=wn.fromWords(s);if(li(o,i),o===0&&i.length===32)return{type:"wsh",hash:i};if(o===0&&i.length===20)return{type:"wpkh",hash:i};if(o===1&&i.length===32)return{type:"tr",pubkey:i};throw new Error("Unknown witness program")}let r=fi.decode(e);if(r.length!==21)throw new Error("Invalid base58 address");if(r[0]===t.pubKeyHash)return{type:"pkh",hash:r.slice(1)};if(r[0]===t.scriptHash)return{type:"sh",hash:r.slice(1)};throw new Error(`Invalid address prefix=${r[0]}`)}}}var Ic,Nc,Lc,Rc,Cc,Hc,_c,$c,Wc,Dc,Oc,Mc,Vc,rt,so,je,fi,ao=Y(()=>{Le();Ae();to();qe();Qt();Qt();Ic={encode(t){if(!(t.length!==2||t[0]!==1||!_(t[1])||H.encode(t[1])!=="4e73"))return{type:"p2a",script:M.encode(t)}},decode:t=>{if(t.type==="p2a")return[1,H.decode("4e73")]}};Nc={encode(t){if(!(t.length!==2||!_(t[0])||!Te(t[0],nt.ecdsa)||t[1]!=="CHECKSIG"))return{type:"pk",pubkey:t[0]}},decode:t=>t.type==="pk"?[t.pubkey,"CHECKSIG"]:void 0},Lc={encode(t){if(!(t.length!==5||t[0]!=="DUP"||t[1]!=="HASH160"||!_(t[2]))&&!(t[3]!=="EQUALVERIFY"||t[4]!=="CHECKSIG"))return{type:"pkh",hash:t[2]}},decode:t=>t.type==="pkh"?["DUP","HASH160",t.hash,"EQUALVERIFY","CHECKSIG"]:void 0},Rc={encode(t){if(!(t.length!==3||t[0]!=="HASH160"||!_(t[1])||t[2]!=="EQUAL"))return{type:"sh",hash:t[1]}},decode:t=>t.type==="sh"?["HASH160",t.hash,"EQUAL"]:void 0},Cc={encode(t){if(!(t.length!==2||t[0]!==0||!_(t[1]))&&t[1].length===32)return{type:"wsh",hash:t[1]}},decode:t=>t.type==="wsh"?[0,t.hash]:void 0},Hc={encode(t){if(!(t.length!==2||t[0]!==0||!_(t[1]))&&t[1].length===20)return{type:"wpkh",hash:t[1]}},decode:t=>t.type==="wpkh"?[0,t.hash]:void 0},_c={encode(t){let e=t.length-1;if(t[e]!=="CHECKMULTISIG")return;let r=t[0],n=t[e-1];if(typeof r!="number"||typeof n!="number")return;let o=t.slice(1,-2);if(n===o.length){for(let s of o)if(!_(s))return;return{type:"ms",m:r,pubkeys:o}}},decode:t=>t.type==="ms"?[t.m,...t.pubkeys,t.pubkeys.length,"CHECKMULTISIG"]:void 0},$c={encode(t){if(!(t.length!==2||t[0]!==1||!_(t[1])))return{type:"tr",pubkey:t[1]}},decode:t=>t.type==="tr"?[1,t.pubkey]:void 0},Wc={encode(t){let e=t.length-1;if(t[e]!=="CHECKSIG")return;let r=[];for(let n=0;n<e;n++){let o=t[n];if(n&1){if(o!=="CHECKSIGVERIFY"||n===e-1)return;continue}if(!_(o))return;r.push(o)}return{type:"tr_ns",pubkeys:r}},decode:t=>{if(t.type!=="tr_ns")return;let e=[];for(let r=0;r<t.pubkeys.length-1;r++)e.push(t.pubkeys[r],"CHECKSIGVERIFY");return e.push(t.pubkeys[t.pubkeys.length-1],"CHECKSIG"),e}},Dc={encode(t){let e=t.length-1;if(t[e]!=="NUMEQUAL"||t[1]!=="CHECKSIG")return;let r=[],n=Xs(t[e-1]);if(typeof n=="number"){for(let o=0;o<e-1;o++){let s=t[o];if(o&1){if(s!==(o===1?"CHECKSIG":"CHECKSIGADD"))throw new Error("OutScript.encode/tr_ms: wrong element");continue}if(!_(s))throw new Error("OutScript.encode/tr_ms: wrong key element");r.push(s)}return{type:"tr_ms",pubkeys:r,m:n}}},decode:t=>{if(t.type!=="tr_ms")return;let e=[t.pubkeys[0],"CHECKSIG"];for(let r=1;r<t.pubkeys.length;r++)e.push(t.pubkeys[r],"CHECKSIGADD");return e.push(t.m,"NUMEQUAL"),e}},Oc={encode(t){return{type:"unknown",script:M.encode(t)}},decode:t=>t.type==="unknown"?M.decode(t.script):void 0},Mc=[Ic,Nc,Lc,Rc,Cc,Hc,_c,$c,Wc,Dc,Oc],Vc=St(M,$t.match(Mc)),rt=it(Vc,t=>{if(t.type==="pk"&&!Te(t.pubkey,nt.ecdsa))throw new Error("OutScript/pk: wrong key");if((t.type==="pkh"||t.type==="sh"||t.type==="wpkh")&&(!_(t.hash)||t.hash.length!==20))throw new Error(`OutScript/${t.type}: wrong hash`);if(t.type==="wsh"&&(!_(t.hash)||t.hash.length!==32))throw new Error("OutScript/wsh: wrong hash");if(t.type==="tr"&&(!_(t.pubkey)||!Te(t.pubkey,nt.schnorr)))throw new Error("OutScript/tr: wrong taproot public key");if((t.type==="ms"||t.type==="tr_ns"||t.type==="tr_ms")&&!Array.isArray(t.pubkeys))throw new Error("OutScript/multisig: wrong pubkeys array");if(t.type==="ms"){let e=t.pubkeys.length;for(let r of t.pubkeys)if(!Te(r,nt.ecdsa))throw new Error("OutScript/multisig: wrong pubkey");if(t.m<=0||e>16||t.m>e)throw new Error("OutScript/multisig: invalid params")}if(t.type==="tr_ns"||t.type==="tr_ms"){for(let e of t.pubkeys)if(!Te(e,nt.schnorr))throw new Error(`OutScript/${t.type}: wrong pubkey`)}if(t.type==="tr_ms"){let e=t.pubkeys.length;if(t.m<=0||e>999||t.m>e)throw new Error("OutScript/tr_ms: invalid params")}return t});so=192,je=(t,e=so)=>Me("TapLeaf",new Uint8Array([e]),dt.encode(t));fi=Wo(F)});function Fn(t){if(Array.isArray(t))return t.map(e=>Fn(e));if(_(t))return Uint8Array.from(t);if(["number","bigint","boolean","string","undefined"].includes(typeof t))return t;if(t===null)return t;if(typeof t=="object")return Object.fromEntries(Object.entries(t).map(([e,r])=>[e,Fn(r)]));throw new Error(`cloneDeep: unknown type=${t} (${typeof t})`)}function jc(t,e,r,n=$){return G(r,e)&&(t=Fs(t,n),e=_n(t)),{privKey:t,pubKey:e}}function ce(t){if(t.script===void 0||t.amount===void 0)throw new Error("Transaction/output: script and amount required");return{script:t.script,amount:t.amount}}function Ze(t){if(t.txid===void 0||t.index===void 0)throw new Error("Transaction/input: txid and index required");return{txid:t.txid,index:t.index,sequence:Xe(t.sequence,wi),finalScriptSig:Xe(t.finalScriptSig,$)}}function uo(t){for(let e in t){let r=e;ri.includes(r)||delete t[r]}}function Zc(t){if(typeof t!="number"||typeof lo[t]!="string")throw new Error(`Invalid SigHash=${t}`);return t}function di(t){let e=t&31;return{isAny:!!(t&V.ANYONECANPAY),isNone:e===V.NONE,isSingle:e===V.SINGLE}}function Xc(t){if(t!==void 0&&{}.toString.call(t)!=="[object Object]")throw new Error(`Wrong object type for transaction options: ${t}`);let e={...t,version:Xe(t.version,Fc),lockTime:Xe(t.lockTime,0),PSBTVersion:Xe(t.PSBTVersion,0)};if(typeof e.allowUnknowInput<"u"&&(t.allowUnknownInputs=e.allowUnknowInput),typeof e.allowUnknowOutput<"u"&&(t.allowUnknownOutputs=e.allowUnknowOutput),typeof e.lockTime!="number")throw new Error("Transaction lock time should be number");if(R.encode(e.lockTime),e.PSBTVersion!==0&&e.PSBTVersion!==2)throw new Error(`Unknown PSBT version ${e.PSBTVersion}`);for(let r of["allowUnknownVersion","allowUnknownOutputs","allowUnknownInputs","disableScriptCheck","bip174jsCompat","allowLegacyWitnessUtxo","lowR"]){let n=e[r];if(n!==void 0&&typeof n!="boolean")throw new Error(`Transation options wrong type: ${r}=${n} (${typeof n})`)}if(e.allowUnknownVersion?typeof e.version=="number":![-1,0,1,2,3].includes(e.version))throw new Error(`Unknown version: ${e.version}`);if(e.customScripts!==void 0){let r=e.customScripts;if(!Array.isArray(r))throw new Error(`wrong custom scripts type (expected array): customScripts=${r} (${typeof r})`);for(let n of r){if(typeof n.encode!="function"||typeof n.decode!="function")throw new Error(`wrong script=${n} (${typeof n})`);if(n.finalizeTaproot!==void 0&&typeof n.finalizeTaproot!="function")throw new Error(`wrong script=${n} (${typeof n})`)}}return Object.freeze(e)}function pi(t){if(t.nonWitnessUtxo&&t.index!==void 0){let e=t.nonWitnessUtxo.outputs.length-1;if(t.index>e)throw new Error(`validateInput: index(${t.index}) not in nonWitnessUtxo`);let r=t.nonWitnessUtxo.outputs[t.index];if(t.witnessUtxo&&(!G(t.witnessUtxo.script,r.script)||t.witnessUtxo.amount!==r.amount))throw new Error("validateInput: witnessUtxo different from nonWitnessUtxo");if(t.txid){if(t.nonWitnessUtxo.outputs.length-1<t.index)throw new Error("nonWitnessUtxo: incorect output index");let o=Jt.fromRaw(Ot.encode(t.nonWitnessUtxo),{allowUnknownOutputs:!0,disableScriptCheck:!0,allowUnknownInputs:!0}),s=H.encode(t.txid);if(o.isFinal&&o.id!==s)throw new Error(`nonWitnessUtxo: wrong txid, exp=${s} got=${o.id}`)}}return t}function Gn(t){if(t.nonWitnessUtxo){if(t.index===void 0)throw new Error("Unknown input index");return t.nonWitnessUtxo.outputs[t.index]}else{if(t.witnessUtxo)return t.witnessUtxo;throw new Error("Cannot find previous output info")}}function hi(t,e,r,n=!1,o=!1){let{nonWitnessUtxo:s,txid:i}=t;typeof s=="string"&&(s=H.decode(s)),_(s)&&(s=Ot.decode(s)),!("nonWitnessUtxo"in t)&&s===void 0&&(s=e?.nonWitnessUtxo),typeof i=="string"&&(i=H.decode(i)),i===void 0&&(i=e?.txid);let c={...e,...t,nonWitnessUtxo:s,txid:i};!("nonWitnessUtxo"in t)&&c.nonWitnessUtxo===void 0&&delete c.nonWitnessUtxo,c.sequence===void 0&&(c.sequence=wi),c.tapMerkleRoot===null&&delete c.tapMerkleRoot,c=Yn(ze,c,e,r,o),Kn.encode(c);let a;return c.nonWitnessUtxo&&c.index!==void 0?a=c.nonWitnessUtxo.outputs[c.index]:c.witnessUtxo&&(a=c.witnessUtxo),a&&!n&&io(a&&a.script,c.redeemScript,c.witnessScript),c}function po(t,e=!1){let r="legacy",n=V.ALL,o=Gn(t),s=rt.decode(o.script),i=s.type,c=s,a=[s];if(s.type==="tr")return n=V.DEFAULT,{txType:"taproot",type:"tr",last:s,lastScript:o.script,defaultSighash:n,sighash:t.sighashType||n};{if((s.type==="wpkh"||s.type==="wsh")&&(r="segwit"),s.type==="sh"){if(!t.redeemScript)throw new Error("inputType: sh without redeemScript");let f=rt.decode(t.redeemScript);(f.type==="wpkh"||f.type==="wsh")&&(r="segwit"),a.push(f),c=f,i+=`-${f.type}`}if(c.type==="wsh"){if(!t.witnessScript)throw new Error("inputType: wsh without witnessScript");let f=rt.decode(t.witnessScript);f.type==="wsh"&&(r="segwit"),a.push(f),c=f,i+=`-${f.type}`}let u=a[a.length-1];if(u.type==="sh"||u.type==="wsh")throw new Error("inputType: sh/wsh cannot be terminal type");let l=rt.encode(u),d={type:i,txType:r,last:u,lastScript:l,defaultSighash:n,sighash:t.sighashType||n};if(r==="legacy"&&!e&&!t.nonWitnessUtxo)throw new Error("Transaction/sign: legacy input without nonWitnessUtxo, can result in attack that forces paying higher fees. Pass allowLegacyWitnessUtxo=true, if you sure");return d}}var zn,Yc,zc,Gc,Fc,ie,wi,Ru,Xe,V,lo,fo,Jt,gi=Y(()=>{Le();Ae();ao();to();qe();Qt();Qt();zn=new Uint8Array(32),Yc={amount:0xffffffffffffffffn,script:$},zc=t=>Math.ceil(t/4),Gc=8,Fc=2,ie=0,wi=4294967295,Ru=$t.decimal(Gc),Xe=(t,e)=>t===void 0?e:t;(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.ALL=1]="ALL",t[t.NONE=2]="NONE",t[t.SINGLE=3]="SINGLE",t[t.ANYONECANPAY=128]="ANYONECANPAY"})(V||(V={}));(function(t){t[t.DEFAULT=0]="DEFAULT",t[t.ALL=1]="ALL",t[t.NONE=2]="NONE",t[t.SINGLE=3]="SINGLE",t[t.DEFAULT_ANYONECANPAY=128]="DEFAULT_ANYONECANPAY",t[t.ALL_ANYONECANPAY=129]="ALL_ANYONECANPAY",t[t.NONE_ANYONECANPAY=130]="NONE_ANYONECANPAY",t[t.SINGLE_ANYONECANPAY=131]="SINGLE_ANYONECANPAY"})(lo||(lo={}));fo=Q({txid:O(32,!0),index:R});Jt=class t{constructor(e={}){this.global={},this.inputs=[],this.outputs=[];let r=this.opts=Xc(e);r.lockTime!==ie&&(this.global.fallbackLocktime=r.lockTime),this.global.txVersion=r.version}static fromRaw(e,r={}){let n=Ot.decode(e),o=new t({...r,version:n.version,lockTime:n.lockTime});for(let s of n.outputs)o.addOutput(s);if(o.outputs=n.outputs,o.inputs=n.inputs,n.witnesses)for(let s=0;s<n.witnesses.length;s++)o.inputs[s].finalScriptWitness=n.witnesses[s];return o}static fromPSBT(e,r={}){let n;try{n=Qr.decode(e)}catch(d){try{n=Jr.decode(e)}catch{throw d}}let o=n.global.version||0;if(o!==0&&o!==2)throw new Error(`Wrong PSBT version=${o}`);let s=n.global.unsignedTx,i=o===0?s?.version:n.global.txVersion,c=o===0?s?.lockTime:n.global.fallbackLocktime,a=new t({...r,version:i,lockTime:c,PSBTVersion:o}),u=o===0?s?.inputs.length:n.global.inputCount;a.inputs=n.inputs.slice(0,u).map((d,f)=>pi({finalScriptSig:$,...n.global.unsignedTx?.inputs[f],...d}));let l=o===0?s?.outputs.length:n.global.outputCount;return a.outputs=n.outputs.slice(0,l).map((d,f)=>({...d,...n.global.unsignedTx?.outputs[f]})),a.global={...n.global,txVersion:i},c!==ie&&(a.global.fallbackLocktime=c),a}toPSBT(e=this.opts.PSBTVersion){if(e!==0&&e!==2)throw new Error(`Wrong PSBT version=${e}`);let r=this.inputs.map(s=>pi(Xr(e,ze,s)));for(let s of r)s.partialSig&&!s.partialSig.length&&delete s.partialSig,s.finalScriptSig&&!s.finalScriptSig.length&&delete s.finalScriptSig,s.finalScriptWitness&&!s.finalScriptWitness.length&&delete s.finalScriptWitness;let n=this.outputs.map(s=>Xr(e,Ge,s)),o={...this.global};return e===0?(o.unsignedTx=se.decode(se.encode({version:this.version,lockTime:this.lockTime,inputs:this.inputs.map(Ze).map(s=>({...s,finalScriptSig:$})),outputs:this.outputs.map(ce)})),delete o.fallbackLocktime,delete o.txVersion):(o.version=e,o.txVersion=this.version,o.inputCount=this.inputs.length,o.outputCount=this.outputs.length,o.fallbackLocktime&&o.fallbackLocktime===ie&&delete o.fallbackLocktime),this.opts.bip174jsCompat&&(r.length||r.push({}),n.length||n.push({})),(e===0?Qr:Jr).encode({global:o,inputs:r,outputs:n})}get lockTime(){let e=ie,r=0,n=ie,o=0;for(let s of this.inputs)s.requiredHeightLocktime&&(e=Math.max(e,s.requiredHeightLocktime),r++),s.requiredTimeLocktime&&(n=Math.max(n,s.requiredTimeLocktime),o++);return r&&r>=o?e:n!==ie?n:this.global.fallbackLocktime||ie}get version(){if(this.global.txVersion===void 0)throw new Error("No global.txVersion");return this.global.txVersion}inputStatus(e){this.checkInputIdx(e);let r=this.inputs[e];return r.finalScriptSig&&r.finalScriptSig.length||r.finalScriptWitness&&r.finalScriptWitness.length?"finalized":r.tapKeySig||r.tapScriptSig&&r.tapScriptSig.length||r.partialSig&&r.partialSig.length?"signed":"unsigned"}inputSighash(e){this.checkInputIdx(e);let r=this.inputs[e].sighashType,n=r===void 0?V.DEFAULT:r,o=n===V.DEFAULT?V.ALL:n&3;return{sigInputs:n&V.ANYONECANPAY,sigOutputs:o}}signStatus(){let e=!0,r=!0,n=[],o=[];for(let s=0;s<this.inputs.length;s++){if(this.inputStatus(s)==="unsigned")continue;let{sigInputs:c,sigOutputs:a}=this.inputSighash(s);if(c===V.ANYONECANPAY?n.push(s):e=!1,a===V.ALL)r=!1;else if(a===V.SINGLE)o.push(s);else if(a!==V.NONE)throw new Error(`Wrong signature hash output type: ${a}`)}return{addInput:e,addOutput:r,inputs:n,outputs:o}}get isFinal(){for(let e=0;e<this.inputs.length;e++)if(this.inputStatus(e)!=="finalized")return!1;return!0}get hasWitnesses(){let e=!1;for(let r of this.inputs)r.finalScriptWitness&&r.finalScriptWitness.length&&(e=!0);return e}get weight(){if(!this.isFinal)throw new Error("Transaction is not finalized");let e=32,r=this.outputs.map(ce);e+=4*bt.encode(this.outputs.length).length;for(let n of r)e+=32+4*dt.encode(n.script).length;this.hasWitnesses&&(e+=2),e+=4*bt.encode(this.inputs.length).length;for(let n of this.inputs)e+=160+4*dt.encode(n.finalScriptSig||$).length,this.hasWitnesses&&n.finalScriptWitness&&(e+=ke.encode(n.finalScriptWitness).length);return e}get vsize(){return zc(this.weight)}toBytes(e=!1,r=!1){return Ot.encode({version:this.version,lockTime:this.lockTime,inputs:this.inputs.map(Ze).map(n=>({...n,finalScriptSig:e&&n.finalScriptSig||$})),outputs:this.outputs.map(ce),witnesses:this.inputs.map(n=>n.finalScriptWitness||[]),segwitFlag:r&&this.hasWitnesses})}get unsignedTx(){return this.toBytes(!1,!1)}get hex(){return H.encode(this.toBytes(!0,this.hasWitnesses))}get hash(){if(!this.isFinal)throw new Error("Transaction is not finalized");return H.encode(Wt(this.toBytes(!0)))}get id(){if(!this.isFinal)throw new Error("Transaction is not finalized");return H.encode(Wt(this.toBytes(!0)).reverse())}checkInputIdx(e){if(!Number.isSafeInteger(e)||0>e||e>=this.inputs.length)throw new Error(`Wrong input index=${e}`)}getInput(e){return this.checkInputIdx(e),Fn(this.inputs[e])}get inputsLength(){return this.inputs.length}addInput(e,r=!1){if(!r&&!this.signStatus().addInput)throw new Error("Tx has signed inputs, cannot add new one");return this.inputs.push(hi(e,void 0,void 0,this.opts.disableScriptCheck)),this.inputs.length-1}updateInput(e,r,n=!1){this.checkInputIdx(e);let o;if(!n){let s=this.signStatus();(!s.addInput||s.inputs.includes(e))&&(o=oi)}this.inputs[e]=hi(r,this.inputs[e],o,this.opts.disableScriptCheck,this.opts.allowUnknown)}checkOutputIdx(e){if(!Number.isSafeInteger(e)||0>e||e>=this.outputs.length)throw new Error(`Wrong output index=${e}`)}getOutput(e){return this.checkOutputIdx(e),Fn(this.outputs[e])}getOutputAddress(e,r=Pt){let n=this.getOutput(e);if(n.script)return Fe(r).encode(rt.decode(n.script))}get outputsLength(){return this.outputs.length}normalizeOutput(e,r,n){let{amount:o,script:s}=e;if(o===void 0&&(o=r?.amount),typeof o!="bigint")throw new Error(`Wrong amount type, should be of type bigint in sats, but got ${o} of type ${typeof o}`);typeof s=="string"&&(s=H.decode(s)),s===void 0&&(s=r?.script);let i={...r,...e,amount:o,script:s};if(i.amount===void 0&&delete i.amount,i=Yn(Ge,i,r,n,this.opts.allowUnknown),qn.encode(i),i.script&&!this.opts.allowUnknownOutputs&&rt.decode(i.script).type==="unknown")throw new Error("Transaction/output: unknown output script type, there is a chance that input is unspendable. Pass allowUnknownOutputs=true, if you sure");return this.opts.disableScriptCheck||io(i.script,i.redeemScript,i.witnessScript),i}addOutput(e,r=!1){if(!r&&!this.signStatus().addOutput)throw new Error("Tx has signed outputs, cannot add new one");return this.outputs.push(this.normalizeOutput(e)),this.outputs.length-1}updateOutput(e,r,n=!1){this.checkOutputIdx(e);let o;if(!n){let s=this.signStatus();(!s.addOutput||s.outputs.includes(e))&&(o=si)}this.outputs[e]=this.normalizeOutput(r,this.outputs[e],o)}addOutputAddress(e,r,n=Pt){return this.addOutput({script:rt.encode(Fe(n).decode(e)),amount:r})}get fee(){let e=0n;for(let n of this.inputs){let o=Gn(n);if(!o)throw new Error("Empty input amount");e+=o.amount}let r=this.outputs.map(ce);for(let n of r)e-=n.amount;return e}preimageLegacy(e,r,n){let{isAny:o,isNone:s,isSingle:i}=di(n);if(e<0||!Number.isSafeInteger(e))throw new Error(`Invalid input idx=${e}`);if(i&&e>=this.outputs.length||e>=this.inputs.length)return _s.encode(1n);r=M.encode(M.decode(r).filter(l=>l!=="CODESEPARATOR"));let c=this.inputs.map(Ze).map((l,d)=>({...l,finalScriptSig:d===e?r:$}));o?c=[c[e]]:(s||i)&&(c=c.map((l,d)=>({...l,sequence:d===e?l.sequence:0})));let a=this.outputs.map(ce);s?a=[]:i&&(a=a.slice(0,e).fill(Yc).concat([a[e]]));let u=Ot.encode({lockTime:this.lockTime,version:this.version,segwitFlag:!1,inputs:c,outputs:a});return Wt(u,Zt.encode(n))}preimageWitnessV0(e,r,n,o){let{isAny:s,isNone:i,isSingle:c}=di(n),a=zn,u=zn,l=zn,d=this.inputs.map(Ze),f=this.outputs.map(ce);s||(a=Wt(...d.map(fo.encode))),!s&&!c&&!i&&(u=Wt(...d.map(w=>R.encode(w.sequence)))),!c&&!i?l=Wt(...f.map(Dt.encode)):c&&e<f.length&&(l=Wt(Dt.encode(f[e])));let p=d[e];return Wt(Zt.encode(this.version),a,u,O(32,!0).encode(p.txid),R.encode(p.index),dt.encode(r),Se.encode(o),R.encode(p.sequence),l,R.encode(this.lockTime),R.encode(n))}preimageWitnessV1(e,r,n,o,s=-1,i,c=192,a){if(!Array.isArray(o)||this.inputs.length!==o.length)throw new Error(`Invalid amounts array=${o}`);if(!Array.isArray(r)||this.inputs.length!==r.length)throw new Error(`Invalid prevOutScript array=${r}`);let u=[At.encode(0),At.encode(n),Zt.encode(this.version),R.encode(this.lockTime)],l=n===V.DEFAULT?V.ALL:n&3,d=n&V.ANYONECANPAY,f=this.inputs.map(Ze),p=this.outputs.map(ce);d!==V.ANYONECANPAY&&u.push(...[f.map(fo.encode),o.map(Se.encode),r.map(dt.encode),f.map(b=>R.encode(b.sequence))].map(b=>F(Ut(...b)))),l===V.ALL&&u.push(F(Ut(...p.map(Dt.encode))));let w=(a?1:0)|(i?2:0);if(u.push(new Uint8Array([w])),d===V.ANYONECANPAY){let b=f[e];u.push(fo.encode(b),Se.encode(o[e]),dt.encode(r[e]),R.encode(b.sequence))}else u.push(R.encode(e));return w&1&&u.push(F(dt.encode(a||$))),l===V.SINGLE&&u.push(e<p.length?F(Dt.encode(p[e])):zn),i&&u.push(je(i,c),At.encode(0),Zt.encode(s)),Me("TapSighash",...u)}signIdx(e,r,n,o){this.checkInputIdx(r);let s=this.inputs[r],i=po(s,this.opts.allowLegacyWitnessUtxo);if(!_(e)){if(!s.bip32Derivation||!s.bip32Derivation.length)throw new Error("bip32Derivation: empty");let l=s.bip32Derivation.filter(f=>f[1].fingerprint==e.fingerprint).map(([f,{path:p}])=>{let w=e;for(let b of p)w=w.deriveChild(b);if(!G(w.publicKey,f))throw new Error("bip32Derivation: wrong pubKey");if(!w.privateKey)throw new Error("bip32Derivation: no privateKey");return w});if(!l.length)throw new Error(`bip32Derivation: no items with fingerprint=${e.fingerprint}`);let d=!1;for(let f of l)this.signIdx(f.privateKey,r)&&(d=!0);return d}n?n.forEach(Zc):n=[i.defaultSighash];let c=i.sighash;if(!n.includes(c))throw new Error(`Input with not allowed sigHash=${c}. Allowed: ${n.join(", ")}`);let{sigOutputs:a}=this.inputSighash(r);if(a===V.SINGLE&&r>=this.outputs.length)throw new Error(`Input with sighash SINGLE, but there is no output with corresponding index=${r}`);let u=Gn(s);if(i.txType==="taproot"){let l=this.inputs.map(Gn),d=l.map(m=>m.script),f=l.map(m=>m.amount),p=!1,w=_n(e),b=s.tapMerkleRoot||$;if(s.tapInternalKey){let{pubKey:m,privKey:S}=jc(e,w,s.tapInternalKey,b),[U,v]=Ve(s.tapInternalKey,b);if(G(U,m)){let W=this.preimageWitnessV1(r,d,c,f),L=Ut(Yr(W,S,o),c!==V.DEFAULT?new Uint8Array([c]):$);this.updateInput(r,{tapKeySig:L},!0),p=!0}}if(s.tapLeafScript){s.tapScriptSig=s.tapScriptSig||[];for(let[m,S]of s.tapLeafScript){let U=S.subarray(0,-1),v=M.decode(U),W=S[S.length-1],L=je(U,W);if(v.findIndex(I=>_(I)&&G(I,w))===-1)continue;let ue=this.preimageWitnessV1(r,d,c,f,void 0,U,W),Vt=Ut(Yr(ue,e,o),c!==V.DEFAULT?new Uint8Array([c]):$);this.updateInput(r,{tapScriptSig:[[{pubKey:w,leafHash:L},Vt]]},!0),p=!0}}if(!p)throw new Error("No taproot scripts signed");return!0}else{let l=qr(e),d=!1,f=Hn(l);for(let b of M.decode(i.lastScript))_(b)&&(G(b,l)||G(b,f))&&(d=!0);if(!d)throw new Error(`Input script doesn't have pubKey: ${i.lastScript}`);let p;if(i.txType==="legacy")p=this.preimageLegacy(r,i.lastScript,c);else if(i.txType==="segwit"){let b=i.lastScript;i.last.type==="wpkh"&&(b=rt.encode({type:"pkh",hash:i.last.hash})),p=this.preimageWitnessV0(r,b,c,u.amount)}else throw new Error(`Transaction/sign: unknown tx type: ${i.txType}`);let w=zs(p,e,this.opts.lowR);this.updateInput(r,{partialSig:[[l,Ut(w,new Uint8Array([c]))]]},!0)}return!0}sign(e,r,n){let o=0;for(let s=0;s<this.inputs.length;s++)try{this.signIdx(e,s,r,n)&&o++}catch{}if(!o)throw new Error("No inputs signed");return o}finalizeIdx(e){if(this.checkInputIdx(e),this.fee<0n)throw new Error("Outputs spends more than inputs amount");let r=this.inputs[e],n=po(r,this.opts.allowLegacyWitnessUtxo);if(n.txType==="taproot"){if(r.tapKeySig)r.finalScriptWitness=[r.tapKeySig];else if(r.tapLeafScript&&r.tapScriptSig){let a=r.tapLeafScript.sort((u,l)=>Mt.encode(u[0]).length-Mt.encode(l[0]).length);for(let[u,l]of a){let d=l.slice(0,-1),f=l[l.length-1],p=rt.decode(d),w=je(d,f),b=r.tapScriptSig.filter(S=>G(S[0].leafHash,w)),m=[];if(p.type==="tr_ms"){let S=p.m,U=p.pubkeys,v=0;for(let W of U){let L=b.findIndex(pt=>G(pt[0].pubKey,W));if(v===S||L===-1){m.push($);continue}m.push(b[L][1]),v++}if(v!==S)continue}else if(p.type==="tr_ns"){for(let S of p.pubkeys){let U=b.findIndex(v=>G(v[0].pubKey,S));U!==-1&&m.push(b[U][1])}if(m.length!==p.pubkeys.length)continue}else if(p.type==="unknown"&&this.opts.allowUnknownInputs){let S=M.decode(d);if(m=b.map(([{pubKey:U},v])=>{let W=S.findIndex(L=>_(L)&&G(L,U));if(W===-1)throw new Error("finalize/taproot: cannot find position of pubkey in script");return{signature:v,pos:W}}).sort((U,v)=>U.pos-v.pos).map(U=>U.signature),!m.length)continue}else{let S=this.opts.customScripts;if(S)for(let U of S){if(!U.finalizeTaproot)continue;let v=M.decode(d),W=U.encode(v);if(W===void 0)continue;let L=U.finalizeTaproot(d,W,b);if(L){r.finalScriptWitness=L.concat(Mt.encode(u)),r.finalScriptSig=$,uo(r);return}}throw new Error("Finalize: Unknown tapLeafScript")}r.finalScriptWitness=m.reverse().concat([d,Mt.encode(u)]);break}if(!r.finalScriptWitness)throw new Error("finalize/taproot: empty witness")}else throw new Error("finalize/taproot: unknown input");r.finalScriptSig=$,uo(r);return}if(!r.partialSig||!r.partialSig.length)throw new Error("Not enough partial sign");let o=$,s=[];if(n.last.type==="ms"){let a=n.last.m,u=n.last.pubkeys,l=[];for(let d of u){let f=r.partialSig.find(p=>G(d,p[0]));f&&l.push(f[1])}if(l=l.slice(0,a),l.length!==a)throw new Error(`Multisig: wrong signatures count, m=${a} n=${u.length} signatures=${l.length}`);o=M.encode([0,...l])}else if(n.last.type==="pk")o=M.encode([r.partialSig[0][1]]);else if(n.last.type==="pkh")o=M.encode([r.partialSig[0][1],r.partialSig[0][0]]);else if(n.last.type==="wpkh")o=$,s=[r.partialSig[0][1],r.partialSig[0][0]];else if(n.last.type==="unknown"&&!this.opts.allowUnknownInputs)throw new Error("Unknown inputs not allowed");let i,c;if(n.type.includes("wsh-")&&(o.length&&n.lastScript.length&&(s=M.decode(o).map(a=>{if(a===0)return $;if(_(a))return a;throw new Error(`Wrong witness op=${a}`)})),s=s.concat(n.lastScript)),n.txType==="segwit"&&(c=s),n.type.startsWith("sh-wsh-")?i=M.encode([M.encode([0,F(n.lastScript)])]):n.type.startsWith("sh-")?i=M.encode([...M.decode(o),n.lastScript]):n.type.startsWith("wsh-")||n.txType!=="segwit"&&(i=o),!i&&!c)throw new Error("Unknown error finalizing input");i&&(r.finalScriptSig=i),c&&(r.finalScriptWitness=c),uo(r)}finalize(){for(let e=0;e<this.inputs.length;e++)this.finalizeIdx(e)}extract(){if(!this.isFinal)throw new Error("Transaction has unfinalized inputs");if(!this.outputs.length)throw new Error("Transaction has no outputs");if(this.fee<0n)throw new Error("Outputs spends more than inputs amount");return this.toBytes(!0,!0)}combine(e){for(let o of["PSBTVersion","version","lockTime"])if(this.opts[o]!==e.opts[o])throw new Error(`Transaction/combine: different ${o} this=${this.opts[o]} other=${e.opts[o]}`);for(let o of["inputs","outputs"])if(this[o].length!==e[o].length)throw new Error(`Transaction/combine: different ${o} length this=${this[o].length} other=${e[o].length}`);let r=this.global.unsignedTx?se.encode(this.global.unsignedTx):$,n=e.global.unsignedTx?se.encode(e.global.unsignedTx):$;if(!G(r,n))throw new Error("Transaction/combine: different unsigned tx");this.global=Yn(Vn,this.global,e.global,void 0,this.opts.allowUnknown);for(let o=0;o<this.inputs.length;o++)this.updateInput(o,e.inputs[o],!0);for(let o=0;o<this.outputs.length;o++)this.updateOutput(o,e.outputs[o],!0);return this}clone(){return t.fromPSBT(this.toPSBT(this.opts.PSBTVersion),this.opts)}}});var jn=Y(()=>{ao();qe();gi();Qt();});function yi(t,e){if(t.length!==32)throw new Error("Payment hash must be 32 bytes");if(e.length!==33&&e.length!==32)throw new Error("Buyer pubkey must be 32 or 33 bytes");let r=e.length===33?e.slice(1):e;return M.encode(["SHA256",t,"EQUALVERIFY",r,"CHECKSIG"])}function Qc(t){if(t===0)return new Uint8Array([]);let e=t<0,r=Math.abs(t),n=[];for(;r>0;)n.push(r&255),r>>>=8;return n[n.length-1]&128?n.push(e?128:0):e&&(n[n.length-1]|=128),new Uint8Array(n)}function bi(t,e){if(t<=0)throw new Error("Refund locktime must be positive");if(e.length!==33&&e.length!==32)throw new Error("Seller pubkey must be 32 or 33 bytes");let r=e.length===33?e.slice(1):e,n=Qc(t);return M.encode([n,"CHECKLOCKTIMEVERIFY","DROP",r,"CHECKSIG"])}function Jc(t){let e=Qe[t.network||"testnet"],r=yi(t.paymentHash,t.buyerPubkey),n=bi(t.refundLocktime,t.sellerPubkey),o=[{script:r,leafVersion:192},{script:n,leafVersion:192}],s=kt("50929b74c1a04954b78b4b6035e97a5e078a5a0f28ec96d547bfee9ace803ac0"),i=co(s,o,e,!0);return{address:i.address,internalPubkey:s,hashlockScript:r,timelockScript:n,outputScript:i.script,taprootTree:o,tapLeafScript:i.tapLeafScript,tapMerkleRoot:i.tapMerkleRoot,leaves:i.leaves,params:t}}function mi(t,e){let r=fn(t);return et(r)===et(e)}var Qe,Zn=Y(()=>{"use strict";cr();ht();jn();Qe={mainnet:Pt,testnet:Wn,signet:{...Wn,bech32:"tb"}}});cr();ht();function Di(){return Nt(32)}function Oi(t,e){let r=fn(t);if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==e[n])return!1;return!0}Zn();jn();ht();Zn();function na(){return 160}function ra(t){let e=Qe[t.network||"testnet"];if(t.preimage.length!==32)throw new Error("Preimage must be 32 bytes");if(t.buyerPrivkey.length!==32)throw new Error("Buyer private key must be 32 bytes");if(!mi(t.preimage,t.swapAddress.params.paymentHash))throw new Error("Preimage does not match payment hash. SHA256(preimage) must equal the payment_hash used to create the swap address.");let r=na(),n=BigInt(Math.ceil(r*t.feeRate)),o=t.fundingAmount-n;if(o<330n)throw new Error(`Output amount ${o} is below dust limit (330 sats). Input: ${t.fundingAmount}, Fee: ${n}`);let s=t.swapAddress.leaves[0],i=new Jt({allowUnknownOutputs:!0,allowUnknownInputs:!0});i.addInput({txid:t.fundingTxid,index:t.fundingVout,witnessUtxo:{script:t.swapAddress.outputScript,amount:t.fundingAmount},tapLeafScript:t.swapAddress.tapLeafScript,tapInternalKey:t.swapAddress.internalPubkey}),i.addOutputAddress(t.destinationAddress,o,e),i.signIdx(t.buyerPrivkey,0);let c=i.getInput(0);if(!c.tapScriptSig||c.tapScriptSig.length===0)throw new Error("Failed to create signature for hashlock spend");let u=[c.tapScriptSig[0][1],t.preimage,s.script,s.controlBlock];i.updateInput(0,{finalScriptWitness:u});let l=i.extract();return{txHex:et(l),txid:i.id,vsize:i.vsize,fee:n,outputAmount:o}}jn();ht();Zn();function oa(){return 140}function sa(t){let e=Qe[t.network||"testnet"];if(t.sellerPrivkey.length!==32)throw new Error("Seller private key must be 32 bytes");let r=t.swapAddress.params.refundLocktime,n=oa(),o=BigInt(Math.ceil(n*t.feeRate)),s=t.fundingAmount-o;if(s<330n)throw new Error(`Output amount ${s} is below dust limit (330 sats). Input: ${t.fundingAmount}, Fee: ${o}`);let i=t.swapAddress.leaves[1],c=new Jt({lockTime:r,allowUnknownOutputs:!0,allowUnknownInputs:!0});c.addInput({txid:t.fundingTxid,index:t.fundingVout,sequence:4294967294,witnessUtxo:{script:t.swapAddress.outputScript,amount:t.fundingAmount},tapLeafScript:t.swapAddress.tapLeafScript,tapInternalKey:t.swapAddress.internalPubkey}),c.addOutputAddress(t.destinationAddress,s,e),c.signIdx(t.sellerPrivkey,0);let a=c.getInput(0);if(!a.tapScriptSig||a.tapScriptSig.length===0)throw new Error("Failed to create signature for timelock spend");let l=[a.tapScriptSig[0][1],i.script,i.controlBlock];c.updateInput(0,{finalScriptWitness:l});let d=c.extract();return{txHex:et(d),txid:c.id,vsize:c.vsize,fee:o,outputAmount:s,locktime:r}}function Je(){return typeof window<"u"&&"nostr"in window}function ae(){return Je()?window.nostr:null}function ia(){let t=ae();if(!t)return{available:!1,name:"None",hasNip04:!1,hasNip44:!1};let e="Unknown NIP-07 Extension";return window.alby?e="Alby":window.nos2x&&(e="nos2x"),{available:!0,name:e,hasNip04:!!t.nip04,hasNip44:!!t.nip44}}async function wo(){let t=ae();if(!t)return{state:"not_detected",error:"No NIP-07 wallet extension detected. Please install Alby, nos2x, or another Nostr wallet."};try{let e=await t.getPublicKey();return!e||e.length!==64?{state:"error",error:"Invalid public key returned from wallet"}:{state:"connected",pubkey:e,provider:t}}catch(e){return{state:"error",error:e.message||"Wallet connection failed"}}}async function Qn(t){let e=ae();if(!e)throw new Error("No NIP-07 wallet connected");return e.signEvent(t)}async function Jn(t,e){let r=ae();if(!r)throw new Error("No NIP-07 wallet connected");if(!r.nip04)throw new Error("Wallet does not support NIP-04 encryption");return r.nip04.encrypt(t,e)}async function tr(t,e){let r=ae();if(!r)throw new Error("No NIP-07 wallet connected");if(!r.nip04)throw new Error("Wallet does not support NIP-04 decryption");return r.nip04.decrypt(t,e)}async function ca(){let t=ae();if(!t||!t.getRelays)return[];try{let e=await t.getRelays();return Object.keys(e)}catch{return[]}}var go={LISTING:30018,ENCRYPTED_DM:4,SWAP_OFFER:30078,SWAP_ACCEPT:30079};function aa(t){let e=JSON.stringify({ordinal:t.ordinalId,price:t.priceSats.toString(),swap_address:t.swapAddress,payment_hash:t.paymentHashHex,refund_locktime:t.refundLocktime,buyer_pubkey:t.buyerPubkeyHex,expires_at:t.expiresAt||Math.floor(Date.now()/1e3)+86400});return{kind:go.SWAP_OFFER,created_at:Math.floor(Date.now()/1e3),tags:[["d",t.ordinalId],["p",t.buyerPubkeyHex],["price",t.priceSats.toString()],["t","sparkle-swap"]],content:e}}async function ua(t){let e=JSON.stringify(t.swapData),r=await Jn(t.recipientPubkey,e);return{kind:go.ENCRYPTED_DM,created_at:Math.floor(Date.now()/1e3),tags:[["p",t.recipientPubkey]],content:r}}async function fa(t){let e=await tr(t.pubkey,t.content);return JSON.parse(e)}var xi=["wss://relay.damus.io","wss://nos.lol","wss://relay.nostr.band","wss://nostr.wine"],Xn=class{constructor(e){Kt(this,"ws",null);Kt(this,"url");Kt(this,"subscriptions",new Map);this.url=e}async connect(){return new Promise((e,r)=>{this.ws=new WebSocket(this.url),this.ws.onopen=()=>e(),this.ws.onerror=n=>r(new Error("WebSocket error")),this.ws.onclose=()=>{this.ws=null},this.ws.onmessage=n=>{try{let o=JSON.parse(n.data);if(o[0]==="EVENT"&&o[2]){let s=o[1],i=o[2],c=this.subscriptions.get(s);c&&c(i)}}catch{}}})}async publish(e){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)throw new Error("Relay not connected");this.ws.send(JSON.stringify(["EVENT",e]))}subscribe(e,r){if(!this.ws||this.ws.readyState!==WebSocket.OPEN)throw new Error("Relay not connected");let n=Math.random().toString(36).slice(2);return this.subscriptions.set(n,r),this.ws.send(JSON.stringify(["REQ",n,e])),n}unsubscribe(e){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(["CLOSE",e])),this.subscriptions.delete(e)}close(){this.ws&&(this.ws.close(),this.ws=null),this.subscriptions.clear()}};async function yo(t=xi){let e=[];return await Promise.allSettled(t.map(async r=>{let n=new Xn(r);try{await n.connect(),e.push(n)}catch{}})),e}async function er(t,e){let r=0;return await Promise.allSettled(e.map(async n=>{try{await n.publish(t),r++}catch{}})),r}function xo(){return typeof window<"u"&&"unisat"in window}function nr(){return typeof window<"u"&&"XverseProviders"in window}function Ei(){return typeof window<"u"&&"LeatherProvider"in window}function Si(){return typeof window<"u"&&"okxwallet"in window&&"bitcoin"in window.okxwallet}function tn(){let t=[];return xo()&&t.push("unisat"),nr()&&t.push("xverse"),Ei()&&t.push("leather"),Si()&&t.push("okx"),t}function Ai(){return xo()?window.unisat:null}async function bo(){let t=Ai();if(!t)return{connected:!1,wallet:"unisat",accounts:[],network:"mainnet",error:"Unisat wallet not detected"};try{let e=await t.requestAccounts(),r=await t.getPublicKey(),n=await t.getNetwork(),o=n==="testnet"?"testnet":n==="signet"?"signet":"mainnet",s=e[0],i="p2wpkh";return s.startsWith("bc1p")||s.startsWith("tb1p")?i="p2tr":s.startsWith("bc1q")||s.startsWith("tb1q")?i="p2wpkh":s.startsWith("3")||s.startsWith("2")?i="p2sh-p2wpkh":(s.startsWith("1")||s.startsWith("m")||s.startsWith("n"))&&(i="p2pkh"),{connected:!0,wallet:"unisat",accounts:[{address:s,publicKey:r,addressType:i}],network:o}}catch(e){return{connected:!1,wallet:"unisat",accounts:[],network:"mainnet",error:e.message||"Failed to connect to Unisat"}}}async function Bi(t,e){let r=Ai();if(!r)throw new Error("Unisat wallet not connected");return{signedPsbtHex:await r.signPsbt(t,e)}}async function mo(){if(!nr())return{connected:!1,wallet:"xverse",accounts:[],network:"mainnet",error:"Xverse wallet not detected"};try{let e=await window.XverseProviders.BitcoinProvider.request("getAccounts",null);if(!e||!e.result||e.result.length===0)throw new Error("No accounts returned");return{connected:!0,wallet:"xverse",accounts:e.result.map(n=>({address:n.address,publicKey:n.publicKey,addressType:n.addressType||"p2wpkh"})),network:"mainnet"}}catch(t){return{connected:!1,wallet:"xverse",accounts:[],network:"mainnet",error:t.message||"Failed to connect to Xverse"}}}async function ki(t,e){if(!nr())throw new Error("Xverse wallet not connected");return{signedPsbtHex:"",signedPsbtBase64:(await window.XverseProviders.BitcoinProvider.request("signPsbt",{psbt:t,signInputs:e,broadcast:!1})).result.psbt}}async function Eo(t){let e=tn();if(e.length===0)return{connected:!1,wallet:"unknown",accounts:[],network:"mainnet",error:"No Bitcoin wallet detected. Please install Unisat, Xverse, or another Bitcoin wallet."};if(t&&e.includes(t))switch(t){case"unisat":return bo();case"xverse":return mo()}let r=e[0];switch(r){case"unisat":return bo();case"xverse":return mo();default:return{connected:!1,wallet:r,accounts:[],network:"mainnet",error:`Wallet ${r} not yet supported`}}}async function So(t,e,r){switch(t){case"unisat":return Bi(e,{autoFinalized:r?.autoFinalized});case"xverse":let n=Buffer.from(e,"hex").toString("base64");if(!r?.inputsToSign)throw new Error("Xverse requires inputsToSign specification");return ki(n,r.inputsToSign);default:throw new Error(`Wallet ${t} not supported for PSBT signing`)}}function Ao(t){if(t.length!==64)throw new Error("Invalid x-only pubkey length");return"02"+t}function la(t){if(t.length!==66)throw new Error("Invalid compressed pubkey length");return t.slice(2)}var rr=class{constructor(e){Kt(this,"state",{nostrConnected:!1,bitcoinConnected:!1,bitcoinAccounts:[],ready:!1,errors:[]});Kt(this,"relays",[]);Kt(this,"onStateChange");this.onStateChange=e}getState(){return{...this.state}}detectWallets(){return{nostr:Je(),bitcoin:tn()}}async connectNostr(){let e=await wo();return e.state==="connected"&&e.pubkey?(this.state.nostrConnected=!0,this.state.nostrPubkey=e.pubkey,this.state.swapPubkey=Ao(e.pubkey),this.updateReady(),this.notifyChange(),!0):(this.state.errors.push(e.error||"Nostr connection failed"),this.notifyChange(),!1)}async connectBitcoin(e){let r=await Eo(e);return r.connected?(this.state.bitcoinConnected=!0,this.state.bitcoinWallet=r.wallet,this.state.bitcoinAccounts=r.accounts,this.state.bitcoinNetwork=r.network,!this.state.swapPubkey&&r.accounts.length>0&&(this.state.swapPubkey=r.accounts[0].publicKey),this.updateReady(),this.notifyChange(),!0):(this.state.errors.push(r.error||"Bitcoin connection failed"),this.notifyChange(),!1)}async connectAll(){let[e,r]=await Promise.all([this.connectNostr().catch(()=>!1),this.connectBitcoin().catch(()=>!1)]);return e||r}async connectRelays(e){return this.relays=await yo(e),this.relays.length}async signAndPublish(e){if(!this.state.nostrConnected)return{success:!1,error:"Nostr wallet not connected"};try{let r=await Qn(e),n=await er(r,this.relays);return{success:n>0,signedEvent:r,relayCount:n}}catch(r){return{success:!1,error:r.message}}}async sendEncryptedDM(e,r){if(!this.state.nostrConnected)return{success:!1,error:"Nostr wallet not connected"};try{let n=JSON.stringify(r),o=await Jn(e,n),s={kind:4,created_at:Math.floor(Date.now()/1e3),tags:[["p",e]],content:o},i=await Qn(s);return await er(i,this.relays),{success:!0}}catch(n){return{success:!1,error:n.message}}}async decryptDM(e){if(!this.state.nostrConnected)return null;try{let r=await tr(e.pubkey,e.content);return JSON.parse(r)}catch{return null}}async signPsbt(e,r){if(!this.state.bitcoinConnected||!this.state.bitcoinWallet)return{error:"Bitcoin wallet not connected"};try{return{signedPsbtHex:(await So(this.state.bitcoinWallet,e,r)).signedPsbtHex}}catch(n){return{error:n.message}}}getSwapPubkey(){return this.state.swapPubkey||null}getBitcoinAddress(){if(this.state.bitcoinAccounts.length===0)return null;let e=this.state.bitcoinAccounts.find(r=>r.addressType==="p2tr");return e?e.address:this.state.bitcoinAccounts[0].address}disconnect(){this.state={nostrConnected:!1,bitcoinConnected:!1,bitcoinAccounts:[],ready:!1,errors:[]},this.relays.forEach(e=>e.close()),this.relays=[],this.notifyChange()}updateReady(){this.state.ready=this.state.nostrConnected}notifyChange(){this.onStateChange&&this.onStateChange(this.getState())}};async function da(t){let e=new rr(t?.onStateChange);return t?.autoConnect&&await e.connectAll(),t?.relayUrls&&await e.connectRelays(t.relayUrls),e}function pa(){return Je()||tn().length>0}var vf={minBidSats:10000n,bidIncrementSats:1000n,durationMs:1440*60*1e3,extensionMs:600*1e3,antiSnipeWindowMs:300*1e3},Uf={minSwapSats:1000n,maxSwapSats:100000000n,swapTimeoutMs:7200*1e3,requireAuth:!0},Pf="0.3.0";export{vf as DEFAULT_AUCTION_CONFIG,Uf as DEFAULT_COORDINATOR_CONFIG,xi as DEFAULT_RELAYS,Xn as NostrRelay,go as SPARKLE_EVENT_KINDS,rr as SparkleWalletManager,Pf as VERSION,ra as buildClaimTransaction,sa as buildRefundTransaction,la as compressedToXOnly,Eo as connectBitcoinWallet,yo as connectToRelays,bo as connectUnisat,wo as connectWallet,mo as connectXverse,yi as createHashlockScript,Jc as createSparkleSwapAddress,ua as createSwapDM,aa as createSwapOfferEvent,bi as createTimelockScript,fa as decodeSwapDM,tr as decryptNip04,tn as detectBitcoinWallets,ia as detectWalletExtension,Jn as encryptNip04,Di as generatePreimage,ae as getNip07Provider,ca as getWalletRelays,pa as hasWalletSupport,da as initializeWallets,Ei as isLeatherAvailable,Je as isNip07Available,Si as isOkxAvailable,xo as isUnisatAvailable,nr as isXverseAvailable,er as publishToRelays,Qn as signEvent,So as signPsbt,Bi as signPsbtUnisat,ki as signPsbtXverse,Oi as verifyPreimage,Ao as xOnlyToCompressed};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@scure/base/lib/esm/index.js:
  (*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/_shortw_utils.js:
@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@scure/btc-signer/esm/index.js:
  (*! scure-btc-signer - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=sparkle-browser.esm.js.map
